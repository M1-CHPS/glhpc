
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="M. Jam, P. de Oliveira Castro">
      
      
      
        <link rel="prev" href="../lecture3/">
      
      
        <link rel="next" href="../lecture5/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>L4: Experimental Design, Profiling, and Performance/Energy Optimization - GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-header__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              L4: Experimental Design, Profiling, and Performance/Energy Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lecture1/" class="md-tabs__link">
          
  
  
  Course

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../annex/bash_cheatsheet/" class="md-tabs__link">
          
  
  
  Annex

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-nav__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Course
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lectures
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Lectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L1 - Introduction to Software Engineering for HPC/AI, Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2 - Performance Aware C Computing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L3 - Building, Testing, and Debugging Scientific Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    L4 - Experimental Design, Profiling, and Performance/Energy Optimization
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L5 - HPC for AI & Environmental Impact of Computation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - C Programming and Memory Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - CMake, Unit Tests, and Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Monte-Carlo sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - Experimental Methodology and Scientific Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 6 - AI Project (1) SGEMM Kernel Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 7 - AI Project (2) Neural Network Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Annex
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Annex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/bash_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux Environment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux Environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/install_fedora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing fedora
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/oh-my-zsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing oh-my-zsh
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Experiment Example
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Experiment Example
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/run_experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    run_experiment.sh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/model_convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_convergence.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="experimental-design-profiling-and-performanceenergy-optimization">Experimental Design, Profiling, and Performance/Energy Optimization<a class="headerlink" href="#experimental-design-profiling-and-performanceenergy-optimization" title="Permanent link">&para;</a></h1>
<div class="mkdocs-only">
<p align="right">
  <a href="../slides/lecture4.pdf">Download as slides 📥</a>
  </p>
</div>
<h2 id="plot-example-intro">Plot Example - Intro<a class="headerlink" href="#plot-example-intro" title="Permanent link">&para;</a></h2>
<p>In the following slides, you will be shown a series of plots; mainly taken from the PPN course reports of previous students.</p>
<p>For each plot:</p>
<ul>
<li>Try to understand what is represented</li>
<li>Explain what you observe</li>
<li>Give a <strong>definitive</strong> conclusion from the data shown</li>
</ul>
<p>Raise your hands when ready to propose an explanation.</p>
<h2 id="plot-example-1">Plot Example (1)<a class="headerlink" href="#plot-example-1" title="Permanent link">&para;</a></h2>
<p><img alt="**PPN Example** - (No Caption)" src="../image/lecture4/example_plot_2.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>PPN Example</strong> - (No Caption)</p>
</div>
<h2 id="plot-example-2">Plot Example (2)<a class="headerlink" href="#plot-example-2" title="Permanent link">&para;</a></h2>
<p><img alt="**PPN Example** - (No Caption)" src="../image/lecture4/example_plot_1.png" width="80%" /></p>
<div class="mkdocs-only">
<p><strong>PPN Example</strong> - (No Caption)</p>
</div>
<h2 id="plot-example-3">Plot Example (3)<a class="headerlink" href="#plot-example-3" title="Permanent link">&para;</a></h2>
<p><img alt="**PPN Example** - (No Caption)" src="../image/lecture4/example_plot_3.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>PPN Example</strong> - (No Caption)</p>
</div>
<h2 id="plot-example-4">Plot Example (4)<a class="headerlink" href="#plot-example-4" title="Permanent link">&para;</a></h2>
<p><img alt="**PPN Example** - &quot;Récapitulatif des optimisations faites&quot;" src="../image/lecture4/example_plot_4.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>PPN Example</strong> - "Récapitulatif des optimisations faites"</p>
</div>
<h2 id="plot-example-5">Plot Example (5)<a class="headerlink" href="#plot-example-5" title="Permanent link">&para;</a></h2>
<p><img alt="**PPN Example** - &quot;Nouveau tracé de la latence cache&quot;" src="../image/lecture4/example_plot_5.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>PPN Example</strong> - "Nouveau tracé de la latence cache"</p>
</div>
<h2 id="plot-example-6">Plot Example (6)<a class="headerlink" href="#plot-example-6" title="Permanent link">&para;</a></h2>
<p><img alt="**Prof Example** - (KNM): (a) Speedup map of GA-Adaptive (7k samples) over the Intel MKL hand-tuning for dgetrf (LU), higher is better. (b) Analysis of the slowdown region (performance regression). (c) Analysis of the high speedup region. \(3,000\) random solutions were evaluated for each distribution." src="../image/lecture4/example_plot_6.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>Prof Example</strong> - (KNM): (a) Speedup map of GA-Adaptive (7k samples) over the Intel MKL hand-tuning for <code>dgetrf</code> (LU), higher is better. (b) Analysis of the slowdown region (performance regression). (c) Analysis of the high speedup region. <span class="arithmatex">\(3,000\)</span> random solutions were evaluated for each distribution.</p>
</div>
<h2 id="plot-example-7">Plot Example (7)<a class="headerlink" href="#plot-example-7" title="Permanent link">&para;</a></h2>
<p><img alt="**Prof Example** - (SPR): Geometric mean Speedup (higher is better)  against the MKL reference configuration on dgetrf (LU), depending on the sampling algorithm. 46x46 validation grid. 7k/15k/30k denotes the samples count. GA-Adaptive outperforms all other sampling strategies for auto-tuning. With 30k samples it achieves a mean speedup of \(\times 1.3\) of the MKL dgetrf kernel." src="../image/lecture4/example_plot_7.png" width="100%" /></p>
<div class="mkdocs-only">
<p><strong>Prof Example</strong> - (SPR): Geometric mean Speedup (higher is better)  against the MKL reference configuration on <code>dgetrf</code> (LU), depending on the sampling algorithm. 46x46 validation grid. 7k/15k/30k denotes the samples count. GA-Adaptive outperforms all other sampling strategies for auto-tuning. With 30k samples it achieves a mean speedup of <span class="arithmatex">\(\times 1.3\)</span> of the MKL dgetrf kernel.</p>
</div>
<h2 id="plot-example-what-makes-a-good-plot">Plot Example - What makes a good plot<a class="headerlink" href="#plot-example-what-makes-a-good-plot" title="Permanent link">&para;</a></h2>
<p>Ask yourself:</p>
<ul>
<li>What do I want to communicate ?</li>
<li>What data do I need ?</li>
<li><strong>Is my plot understandable in ~10 seconds ?</strong></li>
<li>Is my plot self-contained ?</li>
<li>Is the context, environment, and methodology clear ?</li>
</ul>
<h2 id="plot-example-summary">Plot Example - Summary<a class="headerlink" href="#plot-example-summary" title="Permanent link">&para;</a></h2>
<p>HPC is a scientific endeavour; data analysis and plotting are essential.</p>
<ul>
<li>Plots drive decisions</li>
<li>Plots make results trustworthy</li>
<li>Plots explain complex behaviors</li>
</ul>
<p>Datasets are large, multi-disciplinary, and often hard to reproduce.</p>
<h1 id="experimental-methodology">Experimental Methodology<a class="headerlink" href="#experimental-methodology" title="Permanent link">&para;</a></h1>
<h2 id="experimental-methodology-workflow">Experimental Methodology - Workflow<a class="headerlink" href="#experimental-methodology-workflow" title="Permanent link">&para;</a></h2>
<p><img alt="Typical experimental workflow" src="../image/lecture4/experimental_methodology.png" width="100%" /></p>
<h2 id="statistical-significance-introduction">Statistical significance - Introduction<a class="headerlink" href="#statistical-significance-introduction" title="Permanent link">&para;</a></h2>
<p>Computers are noisy, complex systems:</p>
<ul>
<li>Thread scheduling is non deterministic -&gt; runtime varies between runs.</li>
<li>Dynamic CPU frequency (Turbo/Boost)</li>
<li>Systems are heterogeneous (CPU/GPU, dual socket, numa effects, E/P cores)</li>
<li>Temperature/thermal throttling can alter runtime</li>
</ul>
<p>How can we make sure our experimental measurements are reliable and conclusive?</p>
<h2 id="statistical-significance-warm-up-effects">Statistical significance - Warm-up effects<a class="headerlink" href="#statistical-significance-warm-up-effects" title="Permanent link">&para;</a></h2>
<p>Systems need time to reach steady-state:</p>
<p><img alt="" src="../image/lecture4/stability_example.png" width="100%" /></p>
<p><strong>On a laptop</strong>: <span class="arithmatex">\(\mathrm{Mean} = 0.315\ \mathrm{ms},\ \mathrm{CV} = 13.55\%\)</span>  </p>
<p>We need "warm-up" iterations to measure stable performance and skip cold caches, page faults, frequency scaling.</p>
<h2 id="statistical-significance-noise-mitigation">Statistical significance - Noise mitigation<a class="headerlink" href="#statistical-significance-noise-mitigation" title="Permanent link">&para;</a></h2>
<p>Noise can only be mitigated:</p>
<ul>
<li>Stop all other background processes (other users)</li>
<li>Stabilize CPU Frequency (<code>sudo cpupower -g performance</code>)<ul>
<li>Make sure laptops are plugged to avoid powersaving policies</li>
</ul>
</li>
<li>Pin threads via <code>taskset</code>, <code>OMP_PLACES</code> and <code>OMP_PROC_BIND</code></li>
<li>Consider hyperthreading</li>
<li>Use stable compute nodes</li>
</ul>
<p>Meta-repetitions are essential to mitigate noisy measurements.</p>
<h2 id="statistical-significance-example">Statistical significance - Example<a class="headerlink" href="#statistical-significance-example" title="Permanent link">&para;</a></h2>
<p>Same experiment on a stabilized benchmarking server:</p>
<p><img alt="" src="../image/lecture4/stabilized_timings.png" width="100%" /></p>
<p><strong>On a laptop:</strong> <span class="arithmatex">\(\mathrm{Mean} = 0.315\ \mathrm{ms},\ \mathrm{CV} = 13.55\%\)</span><br />
<strong>Stabilized node:</strong> <span class="arithmatex">\(\mathrm{Mean} = 0.582\ \mathrm{ms},\ \mathrm{CV} = 1.14\%\)</span></p>
<h3 class="example" id="note">Note<a class="headerlink" href="#note" title="Permanent link">&para;</a></h3>
<p>Timing on a laptop is always subpar</p>
<h2 id="statistical-significance-mean-median-variance">Statistical significance - Mean, Median, Variance<a class="headerlink" href="#statistical-significance-mean-median-variance" title="Permanent link">&para;</a></h2>
<p>Single-run measurements are misleading; we need statistics.</p>
<ul>
<li>Mean runtime <span class="arithmatex">\(\bar{x} = \frac{1}{n}\sum_{i=1}^{n}x_i\)</span></li>
<li>Median: less sensitive to outliers than the mean</li>
<li>Variance/standard deviation: Measure of uncertainty</li>
<li>Relative metrics are useful: Coefficient of variation (<span class="arithmatex">\(CV = \frac{\sigma}{\bar{x}} \times 100 \%\)</span>)</li>
</ul>
<p>We usually give both the mean and standard deviation when giving performance results.
Plots usually show <span class="arithmatex">\(\bar{x} \pm 1 \sigma\)</span> as a shaded region around the mean to represent uncertainty.</p>
<h3 class="example" id="note_1">Note<a class="headerlink" href="#note_1" title="Permanent link">&para;</a></h3>
<p>Distribution plots can be useful: stable measurements are often close to Gaussian, 
  even if systematic noise may lead to skewed or heavy-tailed distributions.</p>
<h2 id="statistical-significance-confidence-intervals">Statistical significance - Confidence Intervals<a class="headerlink" href="#statistical-significance-confidence-intervals" title="Permanent link">&para;</a></h2>
<p>How to decide how many repetitions we should perform ?</p>
<ul>
<li>Usually, the costlier the kernels, the less meta-repetitions are expected</li>
<li>Short or really short kernels should have more metas to reduce the influence of noise</li>
</ul>
<p>Remember that:</p>
<div class="arithmatex">\[CI_{0.95} \approx \bar{x} \pm 1.96 \cdot \frac{\sigma}{\sqrt{n}}\]</div>
<p>More repetitions increase confidence, but returns diminish:<br />
CI width <span class="arithmatex">\(\propto \tfrac{1}{\sqrt{n}}\)</span></p>
<h3 class="example" id="note_2">Note<a class="headerlink" href="#note_2" title="Permanent link">&para;</a></h3>
<p>Confidence intervals are a bit less common in plots than <span class="arithmatex">\(\pm 1 \sigma\)</span> but can also be used !</p>
<h2 id="statistical-significance-p-score-hypothesis-testing">Statistical significance - p-score &amp; Hypothesis testing<a class="headerlink" href="#statistical-significance-p-score-hypothesis-testing" title="Permanent link">&para;</a></h2>
<p>In HPC, mean/median and variance often suffice, but hypothesis testing can become handy in some contexts.</p>
<ul>
<li>Null hypothesis (<span class="arithmatex">\(H_0\)</span>): GPU and CPU have the same performance for small matrixes<ul>
<li>Differences in measurements are <strong>only</strong> due to noise</li>
</ul>
</li>
<li>
<p>Alternative hypothesis: CPU is faster for small matrixes</p>
</li>
<li>
<p><strong>p-value</strong> is the probability that <span class="arithmatex">\(H_0\)</span> explains a phenomenon.</p>
</li>
<li>If <span class="arithmatex">\(p &lt; 0.05\)</span>, we can safely reject <span class="arithmatex">\(H_0\)</span> (Statistically significant difference)</li>
</ul>
<p>Example:
<span class="arithmatex">\(\bar{x}_{GPU} = 5.0 \mathrm{s}\)</span>, <span class="arithmatex">\(\sigma_{GPU} = 0.20\)</span>,
<span class="arithmatex">\(\bar{x}_{CPU} = 4.8 \mathrm{s}\)</span>, <span class="arithmatex">\(\sigma_{CPU} = 0.4\)</span>,
Two-sample t-test with 10 samples <span class="arithmatex">\(p = 0.02\)</span>.</p>
<p>The measured differences between CPU and GPU execution time are <strong>statistically significant</strong>.</p>
<h2 id="experimental-methodology-reproducibility">Experimental Methodology – Reproducibility<a class="headerlink" href="#experimental-methodology-reproducibility" title="Permanent link">&para;</a></h2>
<p>Reproducibility is a very hot topic (Reproducibility crisis in science):</p>
<ul>
<li><strong>Data and protocols are first-class citizens</strong>: as important as the plots themselves  </li>
<li><strong>Transparency</strong> matters: make data, scripts, and parameters accessible  </li>
<li>Enables others to <strong>verify, build on, and trust your results</strong></li>
</ul>
<h3 class="example" id="note_3">Note<a class="headerlink" href="#note_3" title="Permanent link">&para;</a></h3>
<p>Beware of your mindset: your results should be credible and honest before being "good".</p>
<p>"Our results are unstable, we have yet to understand why, this is what we tried"
  is a completely valid answer</p>
<h1 id="plotting-tools">Plotting Tools<a class="headerlink" href="#plotting-tools" title="Permanent link">&para;</a></h1>
<h2 id="plotting-tools-cheetsheet">Plotting tools - Cheetsheet<a class="headerlink" href="#plotting-tools-cheetsheet" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Name</th>
<th>Use</th>
</tr>
</thead>
<tbody>
<tr>
<td>pandas</td>
<td>Storing and saving tabular data</td>
</tr>
<tr>
<td>numpy</td>
<td>Numerical arrays, manipulating data</td>
</tr>
<tr>
<td>matplotlib</td>
<td>Basic 2D plots, full control</td>
</tr>
<tr>
<td>seaborn</td>
<td>Statistical plots, higher-level API</td>
</tr>
<tr>
<td>logging</td>
<td>Logging experiment progress/results</td>
</tr>
<tr>
<td>OpenCV</td>
<td>Image processing, animations/videos</td>
</tr>
<tr>
<td>ffmpeg</td>
<td>Generating and encoding videos</td>
</tr>
</tbody>
</table>
<p>Lookup the quick reference plotting gallery in the annex!<br />
Both <code>matplotlib</code> and <code>seaborn</code> provide extensive online galleries.</p>
<p>[<strong>Live Example of the matplotlib gallery <a href="https://matplotlib.org/stable/gallery/index.html">https://matplotlib.org/stable/gallery/index.html</a></strong>]</p>
<h2 id="plotting-tools-matplotlib">Plotting tools - Matplotlib<a class="headerlink" href="#plotting-tools-matplotlib" title="Permanent link">&para;</a></h2>
<p>Matplotlib is one of the most widely used plotting libraries.<br />
A figure is built hierarchically from nested elements:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>- Figure (The canvas)
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  - (Subfigures)
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    - Axes (One or more subplots)
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>      - Axis (x/y/z scales, ticks, labels)
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>      - Artists (Lines, markers, text, patches, etc.)
</span></code></pre></div>
<ul>
<li>Data is plotted using axis-level functions like <code>ax.plot</code>, <code>ax.histogram</code></li>
<li>Customization occurs at both the Figure and Axes levels</li>
<li>Complex multi plots layout occur at the Figure level</li>
</ul>
<h2 id="plotting-tools-matplotlib_1">Plotting tools - Matplotlib<a class="headerlink" href="#plotting-tools-matplotlib_1" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../image/lecture4/matplotlib_decomposed.png" /></p>
<h2 id="plotting-tools-matplotlib_2">Plotting tools - Matplotlib<a class="headerlink" href="#plotting-tools-matplotlib_2" title="Permanent link">&para;</a></h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.8</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1"># Create a new figure, single axis</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="c1"># Size is 8 inches by 8 inches, and constrained layout</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="c1"># Plot a simple line</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;My Algorithm&quot;</span><span class="p">)</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="c1"># Customize the axes</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Iteration&quot;</span><span class="p">)</span> <span class="c1"># Name of the X axis</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span> <span class="c1"># Name of the y axis</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="c1"># Title of the plot</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Evolution of Time with the number of iteration&quot;</span><span class="p">)</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Remove white spaces around the figure</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span> <span class="c1"># Draw the legend in the upper right corner</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;my_plot.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span> <span class="c1"># Higher DPI -&gt; bigger image</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="c1"># End the plot and release resources</span>
</span></code></pre></div>
<h2 id="plotting-tools-matplotlib-multi-axis">Plotting tools - Matplotlib (Multi axis)<a class="headerlink" href="#plotting-tools-matplotlib-multi-axis" title="Permanent link">&para;</a></h2>
<p>We can easily have multiple plots on the same figure:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">nrows</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">))</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="o">...</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="o">...</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> <span class="c1"># Alternative to constrained layout</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;my_multiplot.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span></code></pre></div>
<p>Each axis is its own plot, with its own legend and artists.</p>
<h3 class="example" id="note_4">Note<a class="headerlink" href="#note_4" title="Permanent link">&para;</a></h3>
<p>Use the reference (<a href="https://matplotlib.org/stable/api/index.html">https://matplotlib.org/stable/api/index.html</a>) and gallery (<a href="https://matplotlib.org/stable/gallery/index.html">https://matplotlib.org/stable/gallery/index.html</a>) extensively !</p>
<h2 id="plotting-tools-seaborn">Plotting tools - Seaborn<a class="headerlink" href="#plotting-tools-seaborn" title="Permanent link">&para;</a></h2>
<p>Seaborn is an extension of Matplotlib dedicated to statistical visualization:</p>
<p><img alt="&lt;https://seaborn.pydata.org/examples/index.html&gt;" src="../image/lecture4/seaborn_smooth_bivariate_kde.png" width="40%" /></p>
<p>It's useful for histograms, bar charts, kdeplots, scatterplots, and is overall a very good companion library.</p>
<h2 id="plotting-tools-seaborn_1">Plotting tools - Seaborn<a class="headerlink" href="#plotting-tools-seaborn_1" title="Permanent link">&para;</a></h2>
<div class="language-python highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="c1"># Read the dataframe from somewhere</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">)</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="c1"># We must pass the axis to plot on as an argument</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Time&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Algorithm&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Execution time for the algorithm&quot;</span><span class="p">)</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="c1"># Format the x axis ticks: `3.25s`</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">StrMethodFormatter</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{x:.2f}</span><span class="s2">s&quot;</span><span class="p">))</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;my_distribution.png&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p><a href="https://matplotlib.org/stable/gallery/ticks/tick-formatters.html">https://matplotlib.org/stable/gallery/ticks/tick-formatters.html</a></p>
<h1 id="profiling">Profiling<a class="headerlink" href="#profiling" title="Permanent link">&para;</a></h1>
<h2 id="profiling-motivation">Profiling - Motivation<a class="headerlink" href="#profiling-motivation" title="Permanent link">&para;</a></h2>
<ul>
<li>HPC codes are massive, complex and heterogeneous</li>
<li>Humans are <strong>bad</strong> at predicting bottlenecks </li>
<li>Don’t blindly optimize everything</li>
<li>Profiling guides optimization</li>
</ul>
<p>Remember: <strong>Always profile first</strong>.</p>
<h2 id="profiling-amdahls-law">Profiling - Amdahl's law<a class="headerlink" href="#profiling-amdahls-law" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[
\mathrm{Speedup} = \frac{1}{1 - f + \frac{f}{S}}
\]</div>
<p>Where f is the fraction of program improved, and S is the speedup on that fraction.</p>
<p>Example:</p>
<ul>
<li>I have optimized 80% of my application, with a speedup of x10</li>
<li>In total, my application is now <span class="arithmatex">\(\frac{1}{0.2 + (0.8 / 10)} = 3.57 \times\)</span> faster</li>
</ul>
<p>The 20% are a bottleneck !</p>
<h2 id="profiling-steps">Profiling - Steps<a class="headerlink" href="#profiling-steps" title="Permanent link">&para;</a></h2>
<ol>
<li>Where (Hotspots) ?</li>
<li>What functions are we spending time/energy in ?</li>
<li>What <strong>call-tree</strong> are we spending time/energy in ?</li>
<li>Why ?</li>
<li>Arithmetic density, memory access patterns</li>
<li>Cache misses, branch misspredictions, vectorization efficieny (Hardware counters)</li>
<li>What goal ?</li>
<li>Should I optimize for speed ? For energy ? Memory footprint ?<ul>
<li>What about cold storage size/compression ?</li>
</ul>
</li>
<li>Do I have constraints (i.e. limited memory) ?</li>
<li>Should I optimize or switch algorithm ?</li>
</ol>
<h2 id="profiling-time">Profiling - Time<a class="headerlink" href="#profiling-time" title="Permanent link">&para;</a></h2>
<p>It's rather easy to benchmark a single function using a (high-resolution monotonic) clock:
<div class="language-python highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">begin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">my_function</span><span class="p">()</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">elapsed</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">begin</span>
</span></code></pre></div></p>
<p>Very simple way to evalute a function cost</p>
<h2 id="profiling-time-stability">Profiling - Time (Stability)<a class="headerlink" href="#profiling-time-stability" title="Permanent link">&para;</a></h2>
<p>But we have to account for noise:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NWarmup</span><span class="p">):</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>  <span class="n">my_function</span><span class="p">()</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NMeta</span><span class="p">):</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  <span class="n">begin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>  <span class="n">my_function</span><span class="p">()</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>  <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span> 
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time: </span><span class="si">{</span><span class="n">median</span><span class="si">}</span><span class="s2"> +/- </span><span class="si">{</span><span class="n">std</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>We must check that our measures are valid !</p>
<h2 id="profilers-introduction">Profilers - Introduction<a class="headerlink" href="#profilers-introduction" title="Permanent link">&para;</a></h2>
<p>Full application -&gt; Thousands of functions to measure !</p>
<ul>
<li>Profilers are tools to automate this</li>
<li>Two main types:</li>
<li>Sampling: Pause the program and log where the program is
  (Costly functions -&gt; More samples !)</li>
<li>Instrumentation: Modify the program to automatically add timers</li>
</ul>
<p>Profilers can also check for thread usage, vectorization, memory access, etc.</p>
<h2 id="perf-record">Perf - Record<a class="headerlink" href="#perf-record" title="Permanent link">&para;</a></h2>
<p>Linux Perf is a powerful and versatile profiler:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>perf<span class="w"> </span>record<span class="w"> </span>-g<span class="w"> </span>--<span class="w"> </span>python3<span class="w"> </span>./scripts/run_bls.py<span class="w"> </span>kepler-8
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="o">[</span><span class="w"> </span>perf<span class="w"> </span>record:<span class="w"> </span>Woken<span class="w"> </span>up<span class="w"> </span><span class="m">255</span><span class="w"> </span><span class="nb">times</span><span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>data<span class="w"> </span><span class="o">]</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="o">[</span><span class="w"> </span>perf<span class="w"> </span>record:<span class="w"> </span>Wrote<span class="w"> </span><span class="m">85</span>.474<span class="w"> </span>MB<span class="w"> </span>perf.data<span class="w"> </span><span class="o">(</span><span class="m">1220354</span><span class="w"> </span>samples<span class="o">)</span><span class="w"> </span><span class="o">]</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>pert<span class="w"> </span>report<span class="w"> </span>perf.out
</span></code></pre></div>
<p><img alt="" src="../image/lecture4/perf_report.png" /></p>
<p>It's a great tool to quickly get a Tree stack without any dependencies.</p>
<h2 id="profiling-hardware-counters">Profiling - Hardware counters<a class="headerlink" href="#profiling-hardware-counters" title="Permanent link">&para;</a></h2>
<p>In reality, perf is not realy a profiler !</p>
<ul>
<li>The Linux Perf API can be used to access many hardware counters</li>
<li>Perf record is just one usage of perf</li>
</ul>
<p>Most CPUs/GPUs have hardware counters that monitors different events:</p>
<ul>
<li>Number of cycles</li>
<li>Number of instructions</li>
<li>Number of memory access</li>
<li>RAPL</li>
</ul>
<h2 id="profiling-perf-for-hardware-counters">Profiling - Perf for Hardware counters<a class="headerlink" href="#profiling-perf-for-hardware-counters" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>perf<span class="w"> </span>stat<span class="w"> </span>-e<span class="w"> </span>cycles,instructions<span class="w"> </span>python3<span class="w"> </span>./scripts/run_bls.py<span class="w"> </span>kepler-8
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="o">{</span><span class="s1">&#39;period&#39;</span>:<span class="w"> </span><span class="m">3</span>.520136229965055,<span class="w"> </span><span class="s1">&#39;duration&#39;</span>:<span class="w"> </span><span class="m">0</span>.11662673569985234,<span class="w"> </span><span class="s1">&#39;phase&#39;</span>:<span class="w"> </span><span class="m">0</span>.43,<span class="w"> </span><span class="s1">&#39;depth&#39;</span>:<span class="w"> </span><span class="m">0</span>.004983530583444806,<span class="w"> </span><span class="s1">&#39;power&#39;</span>:<span class="w"> </span><span class="m">0</span>.028861678651344452<span class="o">}</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w"> </span>Performance<span class="w"> </span>counter<span class="w"> </span>stats<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;python3 ./scripts/run_bls.py kepler-8&#39;</span>:
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">   </span><span class="m">962</span>,187,248,452<span class="w">      </span>cpu_atom/cycles/<span class="w">                                                        </span><span class="o">(</span><span class="m">43</span>.66%<span class="o">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w"> </span><span class="m">1</span>,119,319,677,606<span class="w">      </span>cpu_core/cycles/<span class="w">                                                        </span><span class="o">(</span><span class="m">56</span>.34%<span class="o">)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w"> </span><span class="m">3</span>,547,146,665,075<span class="w">      </span>cpu_atom/instructions/<span class="w">           </span><span class="c1">#    3.69  insn per cycle              (43.66%)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w"> </span><span class="m">2</span>,837,633,772,530<span class="w">      </span>cpu_core/instructions/<span class="w">           </span><span class="c1">#    2.54  insn per cycle              (56.34%)</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">      </span><span class="m">12</span>.507192456<span class="w"> </span>seconds<span class="w"> </span><span class="nb">time</span><span class="w"> </span>elapsed
</span></code></pre></div>
<h2 id="vtune">VTune<a class="headerlink" href="#vtune" title="Permanent link">&para;</a></h2>
<p>The Intel VTune profiler is more complex but more self-contained than perf:</p>
<p><img alt="" src="../image/lecture4/vtune.png" /></p>
<h2 id="vtune-cpu-usage">VTune - CPU Usage<a class="headerlink" href="#vtune-cpu-usage" title="Permanent link">&para;</a></h2>
<p><img alt="" src="../image/lecture4/cpu_usage_vtune.png" />
<img alt="" src="../image/lecture4/vtune_hpc_thread_usage.png" /></p>
<h2 id="vtune-hpc-performance">VTune - HPC Performance<a class="headerlink" href="#vtune-hpc-performance" title="Permanent link">&para;</a></h2>
<p>VTune has multiple collection mode:</p>
<p><img alt="" src="../image/lecture4/hpc_vtune.png" /></p>
<h2 id="other-profilers">Other profilers<a class="headerlink" href="#other-profilers" title="Permanent link">&para;</a></h2>
<ul>
<li>MAQAO is a profiler developped by the LIPARAD</li>
<li>AMD, NVIDIA and ARM have their own profilers for their platforms</li>
<li>And many, many others (likwid, gprof, etc.) </li>
</ul>
<p>Usually, we combine a "quick" profiler like gprof/perf record with a more indepth one when needed.</p>
<h2 id="profiling-energy">Profiling - Energy<a class="headerlink" href="#profiling-energy" title="Permanent link">&para;</a></h2>
<p>Energy is a growing concern:</p>
<ul>
<li>One HPC cluster consume millions of dollars in electricity <strong>yearly</strong></li>
<li>ChatGPT and other LLM are computationally intensive:</li>
<li>Nvidia GPUs consumes lots of energy</li>
</ul>
<p>On the flip side, measuring energy is harder than measuring time.</p>
<p>Many actors still focus on execution time only -&gt; Energy is perceived as "Second rank"</p>
<h2 id="profiling-rapl">Profiling - RAPL<a class="headerlink" href="#profiling-rapl" title="Permanent link">&para;</a></h2>
<p>Running Average Power Limit (RAPL) is an x86 hardware counter that monitors energy consumption:</p>
<ul>
<li>Energy is tracked at different level</li>
<li>Core, Ram, Package, GPU, etc.</li>
<li>It does not account for secondary power consummers (Fans, Water cooling, etc.) </li>
<li>RAPL is not event based: The entire machine is measured ! (Background processes, etc.)</li>
</ul>
<p>It requires sudo permissions to access (compared to a clock)</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>perf<span class="w"> </span>stat<span class="w"> </span>-a<span class="w"> </span>-j<span class="w"> </span>-e<span class="w"> </span>power/energy-pkg,power/energy-cores<span class="w"> </span>&lt;app&gt;
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="o">{</span><span class="s2">&quot;counter-value&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;88.445740&quot;</span>,<span class="w"> </span><span class="s2">&quot;unit&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Joules&quot;</span>,<span class="w"> </span><span class="s2">&quot;event&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;power/energy-pkg/&quot;</span>,<span class="w"> </span><span class="s2">&quot;event-runtime&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">10002168423</span>,<span class="w"> </span><span class="s2">&quot;pcnt-running&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">100</span>.00<span class="o">}</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="o">{</span><span class="s2">&quot;counter-value&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;10.848633&quot;</span>,<span class="w"> </span><span class="s2">&quot;unit&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;Joules&quot;</span>,<span class="w"> </span><span class="s2">&quot;event&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="s2">&quot;power/energy-cores/&quot;</span>,<span class="w"> </span><span class="s2">&quot;event-runtime&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">10002166697</span>,<span class="w"> </span><span class="s2">&quot;pcnt-running&quot;</span><span class="w"> </span>:<span class="w"> </span><span class="m">100</span>.00<span class="o">}</span>
</span></code></pre></div>
<h2 id="profiling-watt-meter">Profiling - Watt-Meter<a class="headerlink" href="#profiling-watt-meter" title="Permanent link">&para;</a></h2>
<p><img alt="Yokogawa" src="../image/lecture4/yokogawa.png" /></p>
<p>Hardware solutions are also available to monitor energy consumption.
They typically have a slow sampling resolution (<span class="arithmatex">\(\approx 1s\)</span>) and are harder to scale to entire clusters.</p>
<p>On the flip side, they give precise power measurements compared to RAPL.</p>
<h2 id="profiling-rapl-accuracy">Profiling - RAPL accuracy<a class="headerlink" href="#profiling-rapl-accuracy" title="Permanent link">&para;</a></h2>
<p><img alt="Calibration of RAPL" src="../image/lecture4/rapl_calib.png" /></p>
<p>In practice, RAPL underestimates power consumption, but trends are correctly matched.</p>
<h1 id="live-demo">Live Demo<a class="headerlink" href="#live-demo" title="Permanent link">&para;</a></h1>
<h2 id="experiment-example">Experiment example<a class="headerlink" href="#experiment-example" title="Permanent link">&para;</a></h2>
<p><a href="https://m1-chps.github.io/glhpc/annex/example_experiment/run_experiment/">Annex/run_experiment.sh</a></p>
<p><a href="https://m1-chps.github.io/glhpc/annex/example_experiment/model_convergence/">Annex/model_convergence.py</a></p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lecture3/" class="md-footer__link md-footer__link--prev" aria-label="Previous: L3 - Building, Testing, and Debugging Scientific Software">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                L3 - Building, Testing, and Debugging Scientific Software
              </div>
            </div>
          </a>
        
        
          
          <a href="../lecture5/" class="md-footer__link md-footer__link--next" aria-label="Next: L5 - HPC for AI &amp; Environmental Impact of Computation">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                L5 - HPC for AI & Environmental Impact of Computation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      CC BY-NC 4.0; 2025 - Pablo de Oliveira Castro, Mathys E. Jam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.path", "navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "header.autohide", "toc.integrate", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>