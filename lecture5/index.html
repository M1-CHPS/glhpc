
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="P. de Oliveira Castro, M. Jam">
      
      
      
        <link rel="prev" href="../lecture4/">
      
      
        <link rel="next" href="../lab1/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>L5: HPC for AI applications & Environmental impact of computation - GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-header__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              L5: HPC for AI applications & Environmental impact of computation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lecture1/" class="md-tabs__link">
          
  
  
  Course

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../annex/bash_cheatsheet/" class="md-tabs__link">
          
  
  
  Annex

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-nav__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Course
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lectures
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Lectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L1 - Introduction to Software Engineering for HPC/AI, Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2 - Performance Aware C Computing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L3 - Building, Testing, and Debugging Scientific Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L4 - Experimental Design, Profiling, and Performance/Energy Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    L5 - HPC for AI & Environmental Impact of Computation
    
  </span>
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - C Programming and Memory Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - CMake, Unit Tests, and Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Monte-Carlo sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - Experimental Methodology and Scientific Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 6 - AI Project (1) SGEMM Kernel Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 7 - AI Project (2) Neural Network Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Annex
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Annex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/bash_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux Environment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux Environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/install_fedora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing fedora
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/oh-my-zsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing oh-my-zsh
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Experiment Example
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Experiment Example
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/run_experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    run_experiment.sh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/model_convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_convergence.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="hpc-for-ai-environmental-impact-of-computation">HPC for AI &amp; Environmental impact of computation<a class="headerlink" href="#hpc-for-ai-environmental-impact-of-computation" title="Permanent link">&para;</a></h1>
<div class="mkdocs-only">
<p align="right">
  <a href="../slides/lecture5.pdf">Download as slides 📥</a>
  </p>
</div>
<h1 id="introduction-to-ai-applications">Introduction to AI applications<a class="headerlink" href="#introduction-to-ai-applications" title="Permanent link">&para;</a></h1>
<h2 id="ai-renaissance-neural-networks">AI Renaissance: Neural Networks<a class="headerlink" href="#ai-renaissance-neural-networks" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>2012: <strong>AI renaissance</strong> brought by increased data
    availability and computation ressources</p>
<ul>
<li>breakthroughs in multiple domains</li>
<li>many innovations: algorithms, specialized processors, optimizations</li>
</ul>
</li>
<li>
<p>Most systems use <strong>neural networks</strong>:</p>
<ul>
<li>Training (stochastic gradient descent + backpropagation)</li>
<li>Inference (forward pass)</li>
</ul>
</li>
<li>
<p>For both, <strong>the bottleneck is matrix multiplication</strong></p>
</li>
</ul>
<h2 id="objectives">Objectives<a class="headerlink" href="#objectives" title="Permanent link">&para;</a></h2>
<ul>
<li>Explain why dense linear algebra (GEMM) dominates NN compute</li>
<li>Core SGEMM kernel ideas and common optimizations</li>
<li>Use Roofline model to identify bottlenecks</li>
<li>Understand mixed precision &amp; quantization tradeoffs for energy/perf</li>
</ul>
<h2 id="short-introduction-to-neural-networks">Short introduction to Neural Networks<a class="headerlink" href="#short-introduction-to-neural-networks" title="Permanent link">&para;</a></h2>
<ul>
<li>Neural networks are composed of layers of neurons</li>
<li>Each neuron computes a weighted sum of its inputs followed by a non-linear activation function <span class="arithmatex">\(f\)</span></li>
</ul>
<div class="arithmatex">\[ \begin{bmatrix} x_1 \\ x_2 \\ \vdots \\ x_n \end{bmatrix} \rightarrow \textbf{neuron} \rightarrow y \]</div>
<div class="arithmatex">\[ y = f\left(\sum_{i} w_i x_i + b\right) \]</div>
<ul>
<li>
<p>Common activation functions: ReLU, sigmoid, ...</p>
</li>
<li>
<p><strong>Perceptron</strong>: single layer of neurons (1958 Rosenblatt)</p>
</li>
</ul>
<h2 id="architectures">Architectures<a class="headerlink" href="#architectures" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Different architectures for different tasks:</p>
<ul>
<li>Fully connected layers</li>
<li>Convolutional layers</li>
<li>Recursive layers</li>
<li>Transformers (attention mechanism)</li>
</ul>
<p><img alt="Feed-forward NN" src="../image/lecture5/ffn.svg" /></p>
</li>
</ul>
<h2 id="inference">Inference<a class="headerlink" href="#inference" title="Permanent link">&para;</a></h2>
<ul>
<li>Inference: use the trained model to make predictions on new data</li>
<li>
<p>Forward pass through the network:</p>
<ul>
<li>
<p>For each layer, compute the weighted sum and apply activation function</p>
</li>
<li>
<p>The weighted sum is a matrix-vector multiplication for fully connected layers and convolutions (often implemented as GEMM).</p>
</li>
</ul>
</li>
</ul>
<h2 id="two-layer-network">Two layer network<a class="headerlink" href="#two-layer-network" title="Permanent link">&para;</a></h2>
<p>Layer 1:</p>
<ul>
<li><span class="arithmatex">\(X\)</span>: input data [K × B]  → K features, B batch size</li>
<li><span class="arithmatex">\(W_1\)</span>: weights [H × K]  → H hidden units</li>
<li><span class="arithmatex">\(b_1\)</span>: bias [H × 1]</li>
</ul>
<p>Layer 2:</p>
<ul>
<li><span class="arithmatex">\(W_2\)</span>: weights [O × H]  → O outputs</li>
<li><span class="arithmatex">\(b_2\)</span>: bias [O × 1]</li>
</ul>
<p>ReLU <span class="arithmatex">\(f(x) = max(0,x)\)</span>, <span class="arithmatex">\(f'(x) = 1_{x&gt;0}\)</span></p>
<h2 id="forward-inference">Forward inference<a class="headerlink" href="#forward-inference" title="Permanent link">&para;</a></h2>
<ul>
<li>Layer 1 Pre-activation hidden (GEMM, H×K × K×B → H×B)</li>
</ul>
<div class="arithmatex">\[Z_1 = W_1 · X + B_1\]</div>
<ul>
<li>Layer 1 Activation - ReLU (elementwise)</li>
</ul>
<div class="arithmatex">\[H = f(Z_1)\]</div>
<ul>
<li>Layer 2 Output pre-activation (GEMM, O×H × H×B → O×B)</li>
</ul>
<div class="arithmatex">\[Z_2 = W_2 · H + B_2\]</div>
<ul>
<li>Layer 2 Activation - ReLU (elementwise)</li>
</ul>
<div class="arithmatex">\[Y = f(Z_2)\]</div>
<ul>
<li>Forward is dominated by the two large GEMMs Z1 and Z2.</li>
</ul>
<h2 id="training">Training<a class="headerlink" href="#training" title="Permanent link">&para;</a></h2>
<ul>
<li>Training: adjust weights <span class="arithmatex">\(W\)</span> and biases <span class="arithmatex">\(b\)</span> to minimize a loss function <span class="arithmatex">\(L\)</span> over a training dataset</li>
<li>
<p>Use <strong>backpropagation</strong> to compute gradients on each layer (chain rule)</p>
</li>
<li>
<p>Example with one neuron and MSE loss:</p>
</li>
</ul>
<div class="arithmatex">\[ y = f(w_1 x_1 + w_2 x_2 + b) \]</div>
<div class="arithmatex">\[ L = (y - y_{true})^2 \]</div>
<div class="arithmatex">\[ \frac{\partial L}{\partial w_1} = \frac{\partial L}{\partial y} \cdot \frac{\partial y}{\partial w_1} = 2(y - y_{true}) \cdot f'(w_1 x_1 + w_2 x_2 + b) \cdot x_1 \]</div>
<ul>
<li>Backward pass can be efficiently implemented using automatic differentiation and matrix multiplications.</li>
</ul>
<h2 id="stochastic-gradient-descent">Stochastic Gradient Descent<a class="headerlink" href="#stochastic-gradient-descent" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <strong>stochastic gradient descent</strong> to update weights:</li>
</ul>
<div class="arithmatex">\[ w_1 \leftarrow w_1 - \eta \cdot \frac{\partial L}{\partial w_1} \]</div>
<div class="arithmatex">\[ w_2 \leftarrow w_2 - \eta \cdot \frac{\partial L}{\partial w_2} \]</div>
<div class="arithmatex">\[ b \leftarrow b - \eta \cdot \frac{\partial L}{\partial b} \]</div>
<ul>
<li><span class="arithmatex">\(\eta\)</span> is the learning rate</li>
<li>Repeat for many epochs over the training dataset</li>
</ul>
<h2 id="training_1">Training<a class="headerlink" href="#training_1" title="Permanent link">&para;</a></h2>
<ol>
<li>Forward pass to compute <span class="arithmatex">\(H\)</span> and <span class="arithmatex">\(Y\)</span></li>
<li>Compute loss <span class="arithmatex">\(L(Y, Y_{true})\)</span></li>
<li>Backward pass to compute gradients.</li>
</ol>
<p>The backward pass is also dominated by GEMMs.</p>
<h2 id="frameworks">Frameworks<a class="headerlink" href="#frameworks" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Popular frameworks: TensorFlow, PyTorch, JAX, ...</p>
</li>
<li>
<p>High-level APIs for defining models, automatic differentiation, GPU acceleration</p>
</li>
</ul>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Simple 2-layer NN in PyTorch</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Net</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>        <span class="k">return</span> <span class="n">x</span>
</span></code></pre></div>
<h2 id="sgemm">SGEMM<a class="headerlink" href="#sgemm" title="Permanent link">&para;</a></h2>
<p>Single-precision General Matrix-Matrix multiplication (SGEMM):</p>
<div class="arithmatex">\[ RES = A \times B + C \]</div>
<p><img alt="SGEMM" src="../image/lab6/sgemm.svg" /></p>
<h2 id="naive-sgemm-implementation-pseudocode">Naive SGEMM implementation (pseudocode)<a class="headerlink" href="#naive-sgemm-implementation-pseudocode" title="Permanent link">&para;</a></h2>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">// Initialize RES to C</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">        </span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="c1">// Matrix multiply</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">            </span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>FLOPS: <span class="arithmatex">\(2 \times M \times N \times K\)</span></li>
<li>min. Memory: <span class="arithmatex">\(4\)</span> bytes <span class="arithmatex">\(\times (M \times K + K \times N + M \times N)\)</span></li>
</ul>
<h2 id="locality-issues-in-naive-sgemm">Locality issues in naive SGEMM<a class="headerlink" href="#locality-issues-in-naive-sgemm" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[
{\color{green}\text{order in memory} \rightarrow}
\]</div>
<div class="arithmatex">\[
\begin{bmatrix}
\color{red} b_{11} &amp; b_{12} &amp; b_{13} &amp; b_{14} \\
\color{red} b_{21} &amp; b_{22} &amp; b_{23} &amp; b_{24} \\
\color{red} b_{31} &amp; b_{32} &amp; b_{33} &amp; b_{34} \\
\color{red} b_{41} &amp; b_{42} &amp; b_{43} &amp; b_{44} \\
\end{bmatrix}
\]</div>
<ul>
<li>
<p>Stride in accessing B (column-major)</p>
<ul>
<li>Poor spatial locality</li>
<li>Difficult to vectorize</li>
<li>Cache misses for large matrices (reuse distance too large)</li>
</ul>
</li>
<li>
<p><strong>Low arithmetic intensity</strong>: <span class="arithmatex">\(\approx 0.5\)</span> FLOP/byte for large matrices</p>
</li>
</ul>
<h2 id="reordering-loops-ikj">Reordering loops (i,k,j)<a class="headerlink" href="#reordering-loops-ikj" title="Permanent link">&para;</a></h2>
<ul>
<li>Sums <code>RES[i][j] += A[i][k] * B[k][j];</code> are independent → reorder loops:</li>
</ul>
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">            </span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
</span></code></pre></div>
<ul>
<li>
<p><code>A[i][k]</code> does not depend on <code>j</code> → load once, reuse N times</p>
</li>
<li>
<p><code>RES</code> and <code>B</code> accesses are now stride-1 (row-major)</p>
</li>
</ul>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">];</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">             </span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">        </span><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Better spatial locality and easier to vectorize</li>
</ul>
<h2 id="vectorization">Vectorization<a class="headerlink" href="#vectorization" title="Permanent link">&para;</a></h2>
<p>Inner loop assembly for (i,k,j) ordering with AVX (8 <code>float</code> in a vector):</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nl">.loop:</span><span class="w">                                   </span><span class="c1"># Inner loop</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="nf">vmovss</span><span class="w">  </span><span class="no">xmm0</span><span class="p">,</span><span class="w"> </span><span class="no">DWORD</span><span class="w"> </span><span class="no">PTR</span><span class="w"> </span><span class="no">A</span><span class="p">[</span><span class="no">i</span><span class="p">][</span><span class="no">k</span><span class="p">]</span><span class="w">      </span><span class="c1"># Load A[i][k]</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="nf">vbroadcastss</span><span class="w"> </span><span class="no">ymm0</span><span class="p">,</span><span class="w"> </span><span class="no">xmm0</span><span class="w">              </span><span class="c1"># Broadcast scalar to all lanes</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="nf">vmovaps</span><span class="w"> </span><span class="no">ymm1</span><span class="p">,</span><span class="w"> </span><span class="no">YMMWORD</span><span class="w"> </span><span class="no">PTR</span><span class="w"> </span><span class="no">B</span><span class="p">[</span><span class="no">k</span><span class="p">][</span><span class="no">j</span><span class="p">]</span><span class="w">    </span><span class="c1"># Load B[k][j:j+8]</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="nf">vfmadd231ps</span><span class="w"> </span><span class="no">ymm2</span><span class="p">,</span><span class="w"> </span><span class="no">ymm1</span><span class="p">,</span><span class="w"> </span><span class="no">ymm0</span><span class="w">         </span><span class="c1"># Fused multiply-add</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="nf">vmovaps</span><span class="w"> </span><span class="no">YMMWORD</span><span class="w"> </span><span class="no">PTR</span><span class="w"> </span><span class="no">RES</span><span class="p">[</span><span class="no">i</span><span class="p">][</span><span class="no">j</span><span class="p">],</span><span class="w"> </span><span class="no">ymm2</span><span class="w">  </span><span class="c1"># Store RES[i][j:j+8]</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">    </span><span class="nf">add</span><span class="w">     </span><span class="no">j</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">                         </span><span class="c1"># Increment j by 8 (vector width)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">    </span><span class="nf">cmp</span><span class="w">     </span><span class="no">j</span><span class="p">,</span><span class="w"> </span><span class="no">N</span><span class="w">                         </span><span class="c1"># Compare j with N</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="nf">jl</span><span class="w">      </span><span class="no">.loop</span><span class="w">                        </span><span class="c1"># Loop if j &lt; N</span>
</span></code></pre></div>
<h2 id="problems-with-ikj-ordering">Problems with (i,k,j) ordering<a class="headerlink" href="#problems-with-ikj-ordering" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Temporal locality analysis:</p>
<ul>
<li><strong>GOOD</strong>: <span class="arithmatex">\(A[i][k]\)</span> reused in the inner loop, reuse distance <span class="arithmatex">\(1\)</span>.</li>
<li><strong>MEDIUM</strong> : For a fixed <span class="arithmatex">\((i,j)\)</span>, each <span class="arithmatex">\(RES[i][j]\)</span> revisited once per k. So reuse distance <span class="arithmatex">\(K\)</span> (one full row).<ul>
<li>To keep RES in cache between uses you would need cache <span class="arithmatex">\(\ge K \times 4B\)</span></li>
</ul>
</li>
<li><strong>BAD</strong> : For a fixed <span class="arithmatex">\((k,j)\)</span>, <span class="arithmatex">\(B[k][j]\)</span> used once per i. So reuse distance <span class="arithmatex">\(K \times N\)</span> (entire B matrix).<ul>
<li>To keep B in cache between uses you would need cache <span class="arithmatex">\(\ge K \times N \times 4B\)</span></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Still poor temporal locality for large matrices </p>
</li>
<li>
<p>Solution: <strong>tiling / blocking</strong> to increase reuse</p>
</li>
</ul>
<h2 id="blocking-tiling">Blocking (tiling)<a class="headerlink" href="#blocking-tiling" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Idea:</strong> operate on sub-matrices blocks that fit in cache</li>
</ul>
<div class="arithmatex">\[ 
\begin{bmatrix}
\textcolor{red}{A_{11}} &amp; A_{12} \\
A_{21} &amp; A_{22} \\
\end{bmatrix}
\times
\begin{bmatrix}
\textcolor{blue}{B_{11}} &amp; B_{12} \\
B_{21} &amp; B_{22} \\
\end{bmatrix}
=
\begin{bmatrix}
\textcolor{red}{A_{11}}\textcolor{blue}{B_{11}} + A_{12}B_{21} &amp; A _{11}B_{12} + A_{12}B_{22} \\
A_{21}B_{11} + A_{22}B_{21} &amp; A_{21}B_{12} + A_{22}B_{22} \\
\end{bmatrix}
\]</div>
<div class="language-c highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="cp">#define BS 64 </span><span class="c1">// Block size</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="c1">// Loop over blocks</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">            </span><span class="c1">// Operate on blocks A[ii:ii+BS, kk:kk+BS],</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">            </span><span class="c1">// B[kk:kk+BS, jj:jj+BS], RES[ii:ii+BS, jj:jj+BS]</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ii</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="p">);</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kk</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">kk</span><span class="o">+</span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="p">);</span><span class="w"> </span><span class="n">k</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">                    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jj</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">jj</span><span class="o">+</span><span class="n">BS</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">                        </span><span class="n">RES</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
</span></code></pre></div>
<h2 id="parallelization">Parallelization<a class="headerlink" href="#parallelization" title="Permanent link">&para;</a></h2>
<ul>
<li>Each block operation is independent → parallelize over blocks</li>
</ul>
<div class="language-c highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cp">#pragma omp parallel for collapse(3)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">M</span><span class="p">;</span><span class="w"> </span><span class="n">ii</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">jj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">N</span><span class="p">;</span><span class="w"> </span><span class="n">jj</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">kk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">K</span><span class="p">;</span><span class="w"> </span><span class="n">kk</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">BS</span><span class="p">)</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">            </span><span class="c1">// Block multiplication as before</span>
</span></code></pre></div>
<ul>
<li>Each thread works on its own block → no false sharing</li>
<li>Synchronization only at the end of the parallel region</li>
<li>NUMA considerations: pin threads to cores, allocate memory close to threads</li>
<li>Load balancing: static scheduling usually works well for large matrices</li>
</ul>
<h2 id="libraries-autotuners">Libraries &amp; autotuners<a class="headerlink" href="#libraries-autotuners" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Highly optimized SGEMM implementations exist:</p>
<ul>
<li>
<p>OpenBLAS, Intel MKL for CPU</p>
</li>
<li>
<p>NVIDIA cuBLAS for GPU</p>
</li>
</ul>
</li>
<li>
<p>Implementations use blocking, vectorization, parallelization, and many architecture-specific optimizations</p>
</li>
<li>
<p>Libraries are carefully tuned for different sizes and shapes of matrices.</p>
</li>
<li>
<p>Autotuners (e.g., ATLAS, TVM, <strong>MLKAPS</strong>) can generate optimized code for specific hardware and problem sizes.</p>
</li>
</ul>
<h2 id="roofline-model-definitions">Roofline model - Definitions<a class="headerlink" href="#roofline-model-definitions" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Hypothesis: performance is limited by either compute or memory bandwidth</p>
<ul>
<li>performance: FLOP/s (vertical axis)</li>
<li>memory bandwidth: Bytes/s</li>
<li>arithmetic intensity: FLOP/byte (horizontal axis)</li>
</ul>
</li>
<li>
<p>Simple visual model to understand bottlenecks</p>
</li>
</ul>
<h2 id="roofline-model-bounds">Roofline model - Bounds<a class="headerlink" href="#roofline-model-bounds" title="Permanent link">&para;</a></h2>
<p><img alt="Roofline SGEMM" src="../image/lecture5/roofline.svg" /></p>
<ul>
<li><em>Compute bound</em>: horizontal line at peak FLOP/s</li>
<li><em>Memory bound</em>: sloped line with slope = memory bandwidth<ul>
<li><span class="arithmatex">\(\frac{\text{Flop/s}}{\text{Flop/Byte}} = \text{Byte/s}\)</span> </li>
</ul>
</li>
</ul>
<h2 id="roofline-model-sgemm-analysis">Roofline model - SGEMM analysis<a class="headerlink" href="#roofline-model-sgemm-analysis" title="Permanent link">&para;</a></h2>
<p><img alt="Roofline SGEMM" src="../image/lecture5/roofline-sgemm.svg" /></p>
<ul>
<li>Interactive demonstration and analysis</li>
</ul>
<h1 id="environmental-impact-of-computation">Environmental impact of computation<a class="headerlink" href="#environmental-impact-of-computation" title="Permanent link">&para;</a></h1>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Major ecological crisis</strong>: French roadmap targets carbon
    neutrality in 2050 (Stratégie Nationale Bas Carbone).</p>
</li>
<li>
<p>Requires a <strong>40% energy consumption reduction</strong>.</p>
</li>
<li>
<p>HPC <strong>part of the solution</strong>: modeling and improving complex
    systems</p>
</li>
</ul>
<h2 id="hpc-part-of-the-problem">HPC <strong>part of the problem</strong><a class="headerlink" href="#hpc-part-of-the-problem" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Frontier system at ORNL</p>
<ul>
<li>
<p>More than <span class="arithmatex">\(10^{18}\)</span> floating point operations per second</p>
</li>
<li>
<p>Consumes <strong>21MW</strong>: the energy of a small town (<span class="arithmatex">\(16\,000\)</span> french houses)</p>
</li>
</ul>
</li>
</ul>
<p><img alt="image" src="../image/lecture5/frontier.jpg" /></p>
<h2 id="environmental-impact-of-computation_1">Environmental impact of computation<a class="headerlink" href="#environmental-impact-of-computation_1" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>The ICT sector consumes <strong><span class="arithmatex">\(\approx\)</span> 5% of the energy</strong>
    wordwide</p>
</li>
<li>
<p>It accounts for <strong>1.8% - 2.8%</strong> of emitted GHG [Freitag, 2021]:</p>
<ul>
<li>
<p>Accounts for embodied emissions.</p>
</li>
<li>
<p>Shadow energy during the <strong>whole life-cycle: mining, fabrication, transportation, recycling</strong>.</p>
</li>
</ul>
</li>
<li>
<p>GHG emmissions are only one of the sustainability issues</p>
<ul>
<li>
<p>rare-earth mining and waste disposal (eg. Agbogbloshie).</p>
<ul>
<li>human-right abuses, health issues, pollution.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>This presentation focus on energy consumption of HPC</strong></p>
</li>
</ul>
<h2 id="what-about-renewable-energies">What about renewable energies?<a class="headerlink" href="#what-about-renewable-energies" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Low-carbon electricity is a <strong>limited ressource</strong></p>
</li>
<li>
<p>Decarbonation <span class="arithmatex">\(\rightarrow\)</span> huge increase in electricity demand</p>
<ul>
<li>
<p>Heating, Transportation, Industry</p>
</li>
<li>
<p>Computing will compete for low-carbon electricity.</p>
</li>
</ul>
</li>
</ul>
<h1 id="energy-consumption-of-hpc">Energy consumption of HPC<a class="headerlink" href="#energy-consumption-of-hpc" title="Permanent link">&para;</a></h1>
<h2 id="evolution-of-processing-units-batten-2023">Evolution of processing units [Batten, 2023]<a class="headerlink" href="#evolution-of-processing-units-batten-2023" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="../image/lecture5/50-years.svg" /></p>
<h2 id="dennards-scaling-1970-2005">Dennard's scaling 1970-2005<a class="headerlink" href="#dennards-scaling-1970-2005" title="Permanent link">&para;</a></h2>
<div class="arithmatex">\[\begin{aligned}
        \text{CMOS Power} &amp;  &amp; P = \underbrace{1/2.C.V^2.f}_{P_{\text{dynamic}}} + \underbrace{V.I_{\text{leak}}}_{P_{\text{static}}}
\end{aligned}\]</div>
<p>For each generation, transistors dimensions reduced by <strong>30%</strong>,</p>
<ul>
<li>
<p>Voltage and capacitance reduced by 30%</p>
</li>
<li>
<p>Frequency increases: <span class="arithmatex">\(\times 1.4 \approx 1/0.7\)</span></p>
</li>
<li>
<p>Surface halved: <span class="arithmatex">\(0.5 \approx 0.7 \times 0.7\)</span></p>
</li>
<li>
<p>Power halved: <span class="arithmatex">\(\Delta P = 0.7 \times 0.7^2 \times 1/0.7 \approx 0.5\)</span></p>
</li>
</ul>
<p><strong>Power per surface unit remains constant</strong> but manufacturers
double number of transistors and frequency increases:</p>
<ul>
<li>
<p>Power efficiency doubles every 1.57 years</p>
</li>
<li>
<p>Total power increases</p>
</li>
</ul>
<h2 id="multicore-2005-2020">Multicore 2005-2020<a class="headerlink" href="#multicore-2005-2020" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>At current scale, leak currents start increasing
    (<span class="arithmatex">\(P_{\textrm{static}} \nearrow\)</span>). <strong>Power wall slows Dennard's scaling.</strong></p>
</li>
<li>
<p>Computing demand <span class="arithmatex">\(\rightarrow\)</span> <strong>parallelism</strong> and <strong>specialization</strong>.</p>
</li>
<li>
<p>Number of cores increases exponentially since 2005.</p>
</li>
<li>
<p>Power efficiency still improving:</p>
<ul>
<li>
<p>selectively turning-off inactive transistors;</p>
</li>
<li>
<p>architecture design optimizations;</p>
</li>
<li>
<p>software optimizations.</p>
</li>
</ul>
</li>
</ul>
<h2 id="ai-accelerators-2020-2024">AI Accelerators 2020-2024<a class="headerlink" href="#ai-accelerators-2020-2024" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>For domain specific applications, such as AI, specialized
    accelerators are used</p>
<ul>
<li>
<p>Memory and compute units tuned for a specific problem (matrix
    multiplication) ;</p>
</li>
<li>
<p>Faster and better power efficiency: GPU, TPU, FPGA, ASIC.</p>
</li>
</ul>
</li>
</ul>
<h2 id="analysis-of-top-100-hpc-systems">Analysis of TOP-100 HPC systems<a class="headerlink" href="#analysis-of-top-100-hpc-systems" title="Permanent link">&para;</a></h2>
<p><img alt="Evolution of TOP 100 systems" src="../image/lecture5/top500.png" /></p>
<p><strong>Efficiency and Peak computation exponential increase.</strong></p>
<h2 id="rebound-effects">Rebound effects<a class="headerlink" href="#rebound-effects" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>In 1865, Jevons shows that steam engine improvements translate into
    increased coal consumption.</p>
</li>
<li>
<p>In HPC, efficiency gains contribute to the rising computation
    demand.</p>
<ul>
<li><strong>net increase of the total power consumption.</strong></li>
</ul>
</li>
<li>
<p>Rebound effects for data-centers [Masanet, 2020]</p>
<ul>
<li>6% increase in energy consumption from 2010 to 2018\
    (255 % increase in nodes).</li>
</ul>
</li>
<li>
<p><strong>Indirect rebound effects</strong>: computation advances can
    contribute to the acceleration of other fields.</p>
</li>
</ul>
<h1 id="ai-energy-and-computation-costs">AI energy and computation costs<a class="headerlink" href="#ai-energy-and-computation-costs" title="Permanent link">&para;</a></h1>
<h2 id="training-cost-doubles-every-34-months-openai-2020">Training cost doubles every 3.4 months [OpenAI, 2020]<a class="headerlink" href="#training-cost-doubles-every-34-months-openai-2020" title="Permanent link">&para;</a></h2>
<p><img alt="OpenAI, 2020" src="../image/lecture5/ai-and-compute-all-error-no-title.png" /></p>
<h2 id="should-we-study-training-or-inference">Should we study training or inference?<a class="headerlink" href="#should-we-study-training-or-inference" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p><strong>Training</strong>: huge cost but done once</p>
<ul>
<li>
<p>GPT3, 175 billion parameters, <span class="arithmatex">\(\approx\)</span> 314 ZettaFLOP</p>
</li>
<li>
<p>GPT4, 1.7 trillion parameters</p>
</li>
</ul>
</li>
<li>
<p><strong>Inference</strong>: millions of users and requests</p>
<ul>
<li>80-90% cost of a deployed AI system is spend on inference
    [NVIDIA, 2019]</li>
</ul>
</li>
</ul>
<h2 id="inference-cost-diminishing-returns-for-computer-vision">Inference cost - Diminishing returns for computer vision<a class="headerlink" href="#inference-cost-diminishing-returns-for-computer-vision" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="../image/lecture5/flops-acc.png" />
<img alt="image" src="../image/lecture5/joules-acc.png" /></p>
<p>Exponential increase in compute for linear accuracy gain [Desislavov, 2023 / Schwartz, 2019]</p>
<h1 id="more-frugal-computing">More frugal computing?<a class="headerlink" href="#more-frugal-computing" title="Permanent link">&para;</a></h1>
<h2 id="smaller-precision-smaller-models-for-ai">Smaller precision / Smaller models for AI<a class="headerlink" href="#smaller-precision-smaller-models-for-ai" title="Permanent link">&para;</a></h2>
<p><img alt="Shankar 2022" src="../image/lecture5/accelerators-joules.png" /></p>
<p>LLM success of smaller models (Llama, Chinchilla) fine-tuned
for specific tasks with LoRA.</p>
<h2 id="tradeoff-model-complexity-cost-explainability">Tradeoff: Model complexity - Cost - Explainability<a class="headerlink" href="#tradeoff-model-complexity-cost-explainability" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Inference cost grows with model complexity</p>
</li>
<li>
<p>Simpler models are often more interpretable</p>
<ul>
<li>Traditional science also prefers simpler models</li>
</ul>
</li>
<li>
<p>DNN not necessary for all tasks</p>
</li>
</ul>
<h2 id="dvfs-study-of-lu-decomposition">DVFS study of LU decomposition<a class="headerlink" href="#dvfs-study-of-lu-decomposition" title="Permanent link">&para;</a></h2>
<ul>
<li>Knights Mill 72 cores</li>
<li>Intel MKL dgetrf</li>
<li><span class="arithmatex">\(n \in [1000,3000]\)</span></li>
<li>RAPL estimation</li>
</ul>
<p>(Thomas Roglin, M1 UVSQ/INTEL internship 2023)</p>
<h2 id="save-energy-by-computing-slower-1ghz">Save energy by computing slower: 1GHz<a class="headerlink" href="#save-energy-by-computing-slower-1ghz" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="../image/lecture5/lu-pareto1.svg" /></p>
<h2 id="when-accounting-for-the-whole-system">When accounting for the whole system<a class="headerlink" href="#when-accounting-for-the-whole-system" title="Permanent link">&para;</a></h2>
<ul>
<li>Model: RAPL + <strong>40W</strong></li>
<li>System power dominates at low frequencies</li>
</ul>
<h2 id="race-to-idle-26-ghz-compute-faster-and-turn-off-machine">Race to idle: 2.6 GHz compute faster and turn off machine<a class="headerlink" href="#race-to-idle-26-ghz-compute-faster-and-turn-off-machine" title="Permanent link">&para;</a></h2>
<p><img alt="image" src="../image/lecture5/lu-pareto2.svg" /></p>
<h2 id="need-for-an-interdisciplinary-discussion">Need for an interdisciplinary discussion<a class="headerlink" href="#need-for-an-interdisciplinary-discussion" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>AI / HPC can contribute towards sustainability (eg. acceleration of
    weather forecast models) ...  <strong>but its energy cost must be reduced</strong></p>
</li>
<li>
<p><strong>Efficiency:</strong></p>
<ul>
<li>
<p>Improve hardware and software</p>
</li>
<li>
<p>Use smaller models / smaller precision</p>
</li>
</ul>
<p>... <strong>subject to rebound effects</strong></p>
</li>
<li>
<p><strong>Frugality in computing:</strong></p>
<ul>
<li>
<p>Balance computation cost vs. outcomes for each task</p>
</li>
<li>
<p>Choose the right sized model</p>
</li>
<li>
<p>Assess the environmental impact</p>
</li>
</ul>
</li>
</ul>
<h2 id="exemple-e-health-solution-in-tanzania-dacremont-2021">Exemple: e-health solution in Tanzania [d'Acremont, 2021]<a class="headerlink" href="#exemple-e-health-solution-in-tanzania-dacremont-2021" title="Permanent link">&para;</a></h2>
<p>Treatment of febrile children illnesess in dispensaries.</p>
<ul>
<li>
<p><strong>IMCI:</strong> Paper-based decision tree WHO</p>
</li>
<li>
<p><strong>e-POCT</strong> CART tree tailored to real data on a standalone
    tablet</p>
<ul>
<li>
<p>Final CART tree easy to interpret and manually checked</p>
</li>
<li>
<p>Randomized-trial <span class="arithmatex">\(\rightarrow\)</span> better clinical outcomes and
    antibiotic prescription reduction</p>
</li>
</ul>
</li>
<li>
<p>Sophisticated AI that continuously collects patient data and adapts
    the algorithm ?</p>
<ul>
<li>
<p>Increase in hardware and computation costs.</p>
</li>
<li>
<p>Loss in explainability and verification of the algorithm.</p>
</li>
</ul>
</li>
</ul>
<h2 id="references-hpc-for-ai-applications">References - HPC for AI applications<a class="headerlink" href="#references-hpc-for-ai-applications" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://siboehm.com/articles/22/CUDA-MMM">S. Boehm Optimizing, How to Optimize a CUDA Matmul Kernel</a></li>
</ul>
<h2 id="references-environmental-impact-of-computation">References - Environmental impact of computation<a class="headerlink" href="#references-environmental-impact-of-computation" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Jones, Nicola (2018) ‘How to stop data centres from gobbling up the world’s electricity’. Nature, 561(7722), pp. 163–167.</p>
</li>
<li>
<p>Freitag, Charlotte, Berners-Lee, Mike, Widdicks, Kelly, Knowles, Bran, et al. (2021) ‘The real climate and transformative impact of ICT: A critique of estimates, trends, and regulations’. Patterns, 2(9), p. 100340. <a href="https://www.sciencedirect.com/science/article/pii/S2666389921001884">online</a></p>
</li>
<li>
<p>Masanet, Eric, Shehabi, Arman, Lei, Nuoa, Smith, Sarah and Koomey, Jonathan (2020) ‘Recalibrating global data center energy-use estimates’. Science, 367(6481), pp. 984–986.</p>
</li>
<li>
<p>Schwartz, Roy, Dodge, Jesse, Smith, Noah A. and Etzioni, Oren (2019) ‘Green AI’. <a href="http://arxiv.org/abs/1907.10597">arXiv:1907.10597</a></p>
</li>
<li>
<p>Amodei, Dario, Hernandez, Danny, Sastry, Girish, Clark, Jack, et al. (2018) ‘AI and compute. OpenAI’. <a href="https://openai.com/blog/ai-and-compute/">https://openai.com/blog/ai-and-compute/</a></p>
</li>
<li>
<p>D'Acremont presentation: <a href="https://youtu.be/oKcy_cY0QOw">https://youtu.be/oKcy_cY0QOw</a></p>
</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lecture4/" class="md-footer__link md-footer__link--prev" aria-label="Previous: L4 - Experimental Design, Profiling, and Performance/Energy Optimization">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                L4 - Experimental Design, Profiling, and Performance/Energy Optimization
              </div>
            </div>
          </a>
        
        
          
          <a href="../lab1/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 1 - Prerequisites">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Lab 1 - Prerequisites
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      CC BY-NC 4.0; 2025 - Pablo de Oliveira Castro, Mathys E. Jam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.path", "navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "header.autohide", "toc.integrate", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>