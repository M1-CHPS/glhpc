
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lab4/">
      
      
        <link rel="next" href="../lab6/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Lab 5 - Experimental Methodology and Scientific Reporting - GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-header__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 5 - Experimental Methodology and Scientific Reporting
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lecture1/" class="md-tabs__link">
          
  
  
  Course

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../annex/bash_cheatsheet/" class="md-tabs__link">
          
  
  
  Annex

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-nav__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Course
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lectures
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Lectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L1 - Introduction to Software Engineering for HPC/AI, Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2 - Performance Aware C Computing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L3 - Building, Testing, and Debugging Scientific Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L4 - Experimental Design, Profiling, and Performance/Energy Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L5 - HPC for AI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - C Programming and Memory Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - CMake, Unit Tests, and Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Monte-Carlo sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - Experimental Methodology and Scientific Reporting
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 6 - AI Project (1) SGEMM Kernel Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 7 - AI Project (2) Neural Network Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Annex
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Annex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/bash_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux Environment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux Environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/install_fedora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing fedora
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/oh-my-zsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing oh-my-zsh
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lab-5-experimental-methodology-and-scientific-reporting">Lab 5: Experimental Methodology and Scientific Reporting<a class="headerlink" href="#lab-5-experimental-methodology-and-scientific-reporting" title="Permanent link">&para;</a></h1>
<hr class="gradient" />

<p>Regression is a classical machine learning problem. It aims at learning to predict a continuous variable from input features.
For example, we could predict the height of a person (label) depending on their age, gender, and country of origin (features).</p>
<p>In this lab, we will focus on two solutions to the regression problem:</p>
<ul>
<li>The K-Nearest Neighbors (KNN), where we predict the average value from the K nearest points using euclidean or other distances</li>
<li>Gradient Boosting Model (GBM) based on decision trees; using the python package LightGBM.</li>
</ul>
<p>GBM is a very powerful but complex model. Furthermore, it requires the model to be fitted on a training dataset first. Once fitted, predictions are cheap and constant time.
KNN is significantly simpler, does not require model training, but predictions scale with the number of samples in the reference dataset.</p>
<p>In this lab, we will learn how to use and apply low-level profiling tools to quantify the performance of both methods, and apply the experimental design course to present our results.</p>
<p>The provided source code includes:</p>
<ol>
<li>A brute-force C implementation of the K-Nearest Neighbors (KNN) regression method using OpenMP.</li>
<li>An incomplete and partially broken experiment that attempts to compare how the KNN and LightGBM model behave with an increasing number of samples</li>
</ol>
<hr />
<h3 id="1-k-nearest-neighbors-implementation">1. K-Nearest Neighbors implementation<a class="headerlink" href="#1-k-nearest-neighbors-implementation" title="Permanent link">&para;</a></h3>
<p>The KNN application can be run like so:
<div class="language-sh highlight"><span class="filename">Running the KNN</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w"> </span><span class="c1"># Use cmake to build the application, make sure to be in Release mode</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>mkdir<span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>build<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cmake<span class="w"> </span>..<span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="c1"># ./build/myknn &lt;samples.csv&gt; &lt;queries.csv&gt; &lt;k&gt; &lt;num_threads&gt; (&lt;output_csv_path&gt;)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>./build/myknn<span class="w"> </span>./datasets/samples.csv<span class="w"> </span>./datasets/queries.csv<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="m">8</span>
</span></code></pre></div></p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The parser is very basic: both the queries and datasets .csv file must contain exactly the same columns, in the same order.</p>
</div>
<p>By default, if no output path is provided, the application will output inside <code>./results.csv</code></p>
<hr />
<h3 id="2-broken-experiment">2. Broken Experiment<a class="headerlink" href="#2-broken-experiment" title="Permanent link">&para;</a></h3>
<p>The script <code>/scripts/lgbm_vs_knn.py</code> objective is to measure the timing and accuracy of LightGBM and KNN when increasing the number of training samples.
The gathered data should look something like this:
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>model,time,mae,nsamples
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>lgbm,0.2365,0.0186,2400
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>lgbm,0.2308,0.0184,2515
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>lgbm,0.2394,0.0185,2636
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>knn,0.1604,0.02308,2400
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>knn,0.1555,0.0243,2515
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>knn,0.1633,0.0358,2636
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>...
</span></code></pre></div></p>
<p>However, the person writing it never finished it. When fixing this script, you should make sure to:</p>
<ul>
<li>Keep the same test samples for all runs</li>
<li>Use <code>np.linspace</code> or <code>np.geomspace</code> to generate the points</li>
<li>Have the timing encompass both training and prediction (We only focus on a coarse performance comparison here)</li>
<li>Make multiple repetitions to control measurement noise.</li>
<li>You can have one plot for accuracy and one for performance, but having both on the same plot using <code>ax.twinx</code> is a very nice bonus.</li>
</ul>
<hr />
<h3 id="3-provided-files">3. Provided Files<a class="headerlink" href="#3-provided-files" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CMakeLists.txt</code></td>
<td>CMake for the C implementation of KNN</td>
</tr>
<tr>
<td><code>src/dataset.(c\|h)</code></td>
<td>Contain the logic for parsing a .csv dataset</td>
</tr>
<tr>
<td><code>src/main.c</code></td>
<td>Contain the implementation of KNN</td>
</tr>
<tr>
<td><code>datasets/</code></td>
<td>Contain both the training dataset and a sample query file</td>
</tr>
<tr>
<td><code>scripts/my_experiment.py</code></td>
<td>Skeleton of an experiment that you will have to complete</td>
</tr>
<tr>
<td><code>scripts/lgbm_vs_knn.py</code></td>
<td>An incomplete experiment you will have to finish</td>
</tr>
<tr>
<td><code>scripts/stability.py</code></td>
<td>A script to check performance and energy measurement stability</td>
</tr>
</tbody>
</table>
<hr class="gradient" />

<h2 id="1-measuring-energy-execution-time-and-cache-misses">1 - Measuring Energy, execution time, and cache misses<a class="headerlink" href="#1-measuring-energy-execution-time-and-cache-misses" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Measuring energy is a significant part of this lab. However, the RAPL energy counter may not be available on your CPU (Mostly Intel/AMD).
You will have to find a valid machine to run this measurements.</p>
</div>
<p><strong>Linux Perf</strong> is a very powerful tool to collect a variety of performance indicators. Its capable of capturing a list of CPU-events provided by the user, perform automatic meta-repetitions, and aggregate results in a nice JSON format.</p>
<h3 id="1-setup-your-environment">1. Setup your environment<a class="headerlink" href="#1-setup-your-environment" title="Permanent link">&para;</a></h3>
<p>Run the following to setup your lab:</p>
<div class="language-sh highlight"><span class="filename">Setup the lab</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">source</span><span class="w"> </span>./setup_env.sh
</span></code></pre></div>
<hr />
<h3 id="2-stabilize-your-machine">2. Stabilize your machine<a class="headerlink" href="#2-stabilize-your-machine" title="Permanent link">&para;</a></h3>
<p>Run <code>./scripts/stability.py</code> and check the results in <code>results/stability.png</code>. Take the necessary actions to make your machine relatively stable:</p>
<ul>
<li>Set the energy governor to performance
    <div class="language-sh highlight"><span class="filename">Performance governor</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>sudo<span class="w"> </span>cpupower<span class="w"> </span>frequency-set<span class="w"> </span>-g<span class="w"> </span>performance
</span></code></pre></div>
    Remember to switch back to <code>powersave</code> when you're done !</li>
<li>If your CPU has heterogeneous cores, set the thread affinity to only use performance cores. </li>
<li>If on a laptop, remember to plug your laptop to avoid measurements noise due to the battery governor.</li>
<li>Kill any background apps</li>
</ul>
<hr />
<h3 id="3-measuring-energy">3. Measuring Energy<a class="headerlink" href="#3-measuring-energy" title="Permanent link">&para;</a></h3>
<p>What does the following command do ?
<div class="language-sh highlight"><span class="filename">Idle Energy Consumption</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>perf<span class="w"> </span>stat<span class="w"> </span>-a<span class="w"> </span>-j<span class="w"> </span>-e<span class="w"> </span>power/energy-pkg/,power/energy-cores/<span class="w"> </span>sleep<span class="w"> </span><span class="m">60</span>
</span></code></pre></div></p>
<p>Ensure your machine is mostly idle and execute this command.</p>
<h4 id="a-what-does-energy-pkg-measure-and-whats-the-unit-what-about-the-other-events">a) What does <code>energy-pkg</code> measure, and what's the unit ? What about the other events ?<a class="headerlink" href="#a-what-does-energy-pkg-measure-and-whats-the-unit-what-about-the-other-events" title="Permanent link">&para;</a></h4>
<p>Compute your machine idle power consumption: <span class="arithmatex">\(P_{idle} = \frac{\text{energy-pkg}}{T}\)</span>.</p>
<h4 id="b-measure-the-knn-energy-consumption">b) Measure the KNN energy consumption<a class="headerlink" href="#b-measure-the-knn-energy-consumption" title="Permanent link">&para;</a></h4>
<div class="language-sh highlight"><span class="filename">Workload Consumption</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">time</span><span class="w"> </span>perf<span class="w"> </span>stat<span class="w"> </span>-r<span class="w"> </span><span class="m">5</span><span class="w"> </span>-a<span class="w"> </span>-j<span class="w"> </span>-e<span class="w"> </span>power/energy-pkg/,power/energy-cores/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span>./build/myknn<span class="w"> </span>./datasets/samples.csv<span class="w"> </span>./datasets/queries.csv<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>
</span></code></pre></div>
<p>Note that the <code>-r 5</code> flag causes <code>perf</code> to perform 5 meta-repetitions. The <code>time</code> command reports the sum of the timings for all runs.
Compute the effective power and energy consumption of the <code>knn</code> application. Remember to substract <span class="arithmatex">\(P_{idle}\)</span>.</p>
<hr />
<h3 id="4-measuring-performance-metrics">4. Measuring performance metrics<a class="headerlink" href="#4-measuring-performance-metrics" title="Permanent link">&para;</a></h3>
<p>What does the following command do ?
<div class="language-sh highlight"><span class="filename">Measuring performance</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">time</span><span class="w"> </span>perf<span class="w"> </span>stat<span class="w"> </span>-r<span class="w"> </span><span class="m">5</span><span class="w"> </span>-e<span class="w"> </span>instructions,cycles,cache-references,cache-misses<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span>./build/myknn<span class="w"> </span>./datasets/samples.csv<span class="w"> </span>./datasets/queries.csv<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>
</span></code></pre></div></p>
<p>Execute this command and answer the following questions.</p>
<h4 id="a-whats-the-observed-variance-in-the-execution-time">a) What's the observed variance in the execution time ?<a class="headerlink" href="#a-whats-the-observed-variance-in-the-execution-time" title="Permanent link">&para;</a></h4>
<h4 id="b-whats-the-mean-instructions-cycle">b) What's the mean instructions / cycle ?<a class="headerlink" href="#b-whats-the-mean-instructions-cycle" title="Permanent link">&para;</a></h4>
<p>A Memory bound application has the CPU waiting for data to be retrieved for memory, meaning the CPU has a low number of instructions / cycle.
A compute bound application is limited by the CPU performance.</p>
<p>Is the application memory bound ?</p>
<h4 id="c-whats-the-percentage-of-cache-misses">c) What's the percentage of cache misses ?<a class="headerlink" href="#c-whats-the-percentage-of-cache-misses" title="Permanent link">&para;</a></h4>
<p>Memory accesses are reported as "Cache References"</p>
<h4 id="d-how-does-the-percentage-of-cache-miss-evolve-when-increasing-the-number-of-threads">d) How does the percentage of cache miss evolve when increasing the number of threads ?<a class="headerlink" href="#d-how-does-the-percentage-of-cache-miss-evolve-when-increasing-the-number-of-threads" title="Permanent link">&para;</a></h4>
<p>Could you explain why ?</p>
<hr />
<h3 id="5-simple-profiling">5. Simple Profiling<a class="headerlink" href="#5-simple-profiling" title="Permanent link">&para;</a></h3>
<p>Modify the <code>CMakeLists.txt</code> to add the <code>-pg -g</code> compilation flag, then rerun the application:</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Cmake does not always detect flag changes and may rebuild with the old flags. Delete <code>./build/CMakeCache.txt</code> and rerun <code>setup_env.sh</code></p>
</div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>./build/myknn ./datasets/samples.csv ./datasets/queries.csv 5 1 
</span></code></pre></div>
<p>You should see that a <code>gmon.out</code> file has appeared; this file contains the profile of the application.</p>
<p>Run the following:</p>
<div class="language-sh highlight"><span class="filename">Running gprof</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>gprof<span class="w"> </span>./build/myknn<span class="w"> </span>./gmon.out
</span></code></pre></div>
<p>Where is most of the time spent in the application ?</p>
<p><strong>Remove the -pg flag as it will slow your application and bias your measurements later on</strong></p>
<hr class="gradient" />

<h2 id="2-scientific-report-model-comparison-and-energy-study">2 - Scientific Report: Model Comparison and Energy Study<a class="headerlink" href="#2-scientific-report-model-comparison-and-energy-study" title="Permanent link">&para;</a></h2>
<p>You are tasked to write a <strong>maximum three page scientific report</strong> with the following sections:</p>
<h4 id="a-stability-and-environment">a) Stability and Environment<a class="headerlink" href="#a-stability-and-environment" title="Permanent link">&para;</a></h4>
<ul>
<li>Document CPU model, number of cores, Cache(s) size, Ram, OS version, compilers / python version<ul>
<li>The dataset <code>datasets/samples.csv</code> contains <span class="arithmatex">\(\text{ncols} * \text{nrows}\)</span> floating point values, stored as 32 bits floats in <code>myknn</code>.
Does this dataset fit in your CPU caches ?</li>
</ul>
</li>
<li>Specify CPU gorvernor and thread affinity settings used during the experiments</li>
<li>A stability plot generated through <code>scripts/stability.py</code>. </li>
<li>Make sure to add a table with the mean and standard deviation of each metric.</li>
</ul>
<h4 id="b-a-corrected-and-improved-version-of-the-provided-experiment-comparing-knn-regression-with-lightgbm">b) A corrected and improved version of the provided experiment comparing KNN regression with LightGBM<a class="headerlink" href="#b-a-corrected-and-improved-version-of-the-provided-experiment-comparing-knn-regression-with-lightgbm" title="Permanent link">&para;</a></h4>
<ul>
<li>A paragraph describing the goal of the experiment</li>
<li>A paragraph explaining your protocol</li>
<li>A plot comparing KNN and LightGBM accuracy and execution time when increasing the number of samples<ul>
<li>From this plot, we should observe that: Accuracy increases with the number of samples; the execution time of KNN grows linearly with the number of samples;
LightGBM has good scalability and accuracy, and is faster than KNN.</li>
<li>Make sure to include confidence intervals.</li>
</ul>
</li>
<li>Your observations and conclusions</li>
</ul>
<h4 id="c-an-experiment-of-your-choosing">c) An experiment of your choosing<a class="headerlink" href="#c-an-experiment-of-your-choosing" title="Permanent link">&para;</a></h4>
<ul>
<li>Formulate a specific question of your choice about energy consumption. Examples:<ul>
<li>How does the <span class="arithmatex">\(\text{efficiency} = \frac{E}{\text{# of predictions}}\)</span> scale with the number of threads for both KNN and LightGBM ?</li>
<li>How reproducible and stable are RAPL energy measurements for LightGBM and KNN across multiple runs and thread counts?</li>
<li>What is the relationship between energy consumption and the number <span class="arithmatex">\(k\)</span> of nearest neighbors ?</li>
</ul>
</li>
<li>Formulate a clear hypothesis for your energy experiment (What you expect to see)</li>
<li>Explain your experimental design</li>
<li>Provide an informative plot that answers the question</li>
<li>Present your observations and conclusions</li>
</ul>
<p>Your report will be evaluated on clarity, conciseness, and scientific rigor. Avoid unnecessary implementation details; focus on producing convincing results.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lab4/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 4 - Monte-Carlo sampling">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Lab 4 - Monte-Carlo sampling
              </div>
            </div>
          </a>
        
        
          
          <a href="../lab6/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 6 - AI Project (1) SGEMM Kernel Optimization">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Lab 6 - AI Project (1) SGEMM Kernel Optimization
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      CC BY-NC 4.0; 2025 - Pablo de Oliveira Castro, Mathys E. Jam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.path", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "header.autohide", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>