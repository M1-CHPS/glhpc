
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../lab5/">
      
      
        <link rel="next" href="../lab7/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Lab 6 - AI Project (1) SGEMM Kernel Optimization - GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-header__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 6 - AI Project (1) SGEMM Kernel Optimization
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../lecture1/" class="md-tabs__link">
          
  
  
  Course

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../annex/bash_cheatsheet/" class="md-tabs__link">
          
  
  
  Annex

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l&#39;Intelligence Artificielle" class="md-nav__button md-logo" aria-label="GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    GLHPC - Génie Logiciel pour le Calcul Haute Performance et l'Intelligence Artificielle
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Course
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Course
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Lectures
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Lectures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L1 - Introduction to Software Engineering for HPC/AI, Development Environment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L2 - Performance Aware C Computing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L3 - Building, Testing, and Debugging Scientific Software
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L4 - Experimental Design, Profiling, and Performance/Energy Optimization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lecture5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    L5 - HPC for AI & Environmental Impact of Computation
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1 - Prerequisites
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2 - C Programming and Memory Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 3 - CMake, Unit Tests, and Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 4 - Monte-Carlo sampling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 5 - Experimental Methodology and Scientific Reporting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 6 - AI Project (1) SGEMM Kernel Optimization
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 7 - AI Project (2) Neural Network Inference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Annex
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Annex
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/bash_cheatsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bash cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Linux Environment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Linux Environment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/install_fedora/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing fedora
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/oh-my-zsh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installing oh-my-zsh
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Experiment Example
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Experiment Example
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/run_experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    run_experiment.sh
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../annex/example_experiment/model_convergence/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    model_convergence.py
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lab-6-ai-project-1-sgemm-kernel-optimization">Lab 6 - AI Project (1) SGEMM Kernel Optimization<a class="headerlink" href="#lab-6-ai-project-1-sgemm-kernel-optimization" title="Permanent link">&para;</a></h1>
<hr class="gradient" />

<h2 id="1-implementing-a-naive-sgemm">1 - Implementing a naive SGEMM<a class="headerlink" href="#1-implementing-a-naive-sgemm" title="Permanent link">&para;</a></h2>
<p>We work on multiplication of dense matrices. This algorithm is everywhere (ML, data analysis, 3D engines, physics). 
Here we focus on single-precision floating point SGEMM as used in many ML workloads.</p>
<p>The operation we want to implement is:</p>
<div class="arithmatex">\[ \text{RES} = A \times B + C \]</div>
<p><img alt="SGEMM" src="../image/lab6/sgemm.svg" /></p>
<div class="language-c highlight"><span class="filename">sgemm.h</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cm">/**</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="cm"> * @brief SGEMM (Single-precision General Matrix Multiply)</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cm"> *</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cm"> * Performs the matrix multiplication operation:</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="cm"> * RES = A*B + C</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="cm"> *</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="cm"> * @param A Input matrix A with dimensions M x K (row-major order)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="cm"> * @param B Input matrix B with dimensions K x N</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="cm"> * @param C Input matrix C with dimensions M x N</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="cm"> * @param M Number of rows in matrix A and C</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="cm"> * @param N Number of columns in matrix B and C</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="cm"> * @param K Number of columns in matrix A and rows in matrix B</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="cm"> * @param RES Output matrix with dimensions M x N, where the result will be stored</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="cm"> */</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="kt">void</span><span class="w"> </span><span class="nf">sgemm</span><span class="p">(</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">A</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">B</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">C</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="o">*</span><span class="n">RES</span><span class="p">,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">M</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">K</span><span class="p">);</span>
</span></code></pre></div>
<p>Matrices are stored in row-major order (C-style). That is, the elements of each row are stored in contiguous memory locations. For example, a 3x3 matrix:</p>
<div class="arithmatex">\[ \begin{pmatrix}
a_{11} &amp; a_{12} &amp; a_{13} \\
a_{21} &amp; a_{22} &amp; a_{23} \\
a_{31} &amp; a_{32} &amp; a_{33}
\end{pmatrix} \]</div>
<p>is stored in memory as:</p>
<div class="arithmatex">\[ [a_{11}, a_{12}, a_{13}, a_{21}, a_{22}, a_{23}, a_{31}, a_{32}, a_{33}] \]</div>
<h3 id="1-creating-random-matrices">1. Creating random matrices<a class="headerlink" href="#1-creating-random-matrices" title="Permanent link">&para;</a></h3>
<p>Inside <code>src/</code> you find starter files: <code>sgemm.h</code>, <code>sgemm.c</code>, <code>main.c</code>.
Inside <code>tests/</code> you will find <code>test_runner.c</code> that contains a starter test harness.</p>
<h4 id="a-implement-random_matrix-inside-sgemmc-to-generate-random-matrices">a) Implement <code>random_matrix</code> inside <code>sgemm.c</code> to generate random matrices.<a class="headerlink" href="#a-implement-random_matrix-inside-sgemmc-to-generate-random-matrices" title="Permanent link">&para;</a></h4>
<h4 id="b-add-a-test-in-test_sgemmc-that-checks-that-random_matrix-correctly-generates-matrices-with-values-in-the-range-10-10-call-the-test-from-test_runnerc">b) Add a test in <code>test_sgemm.c</code> that checks that <code>random_matrix</code> correctly generates matrices with values in the range <span class="arithmatex">\([-1.0, 1.0]\)</span>. Call the test from <code>test_runner.c</code>.<a class="headerlink" href="#b-add-a-test-in-test_sgemmc-that-checks-that-random_matrix-correctly-generates-matrices-with-values-in-the-range-10-10-call-the-test-from-test_runnerc" title="Permanent link">&para;</a></h4>
<h4 id="c-create-a-cmakelisttxt">c) Create a <code>CMakeList.txt</code><a class="headerlink" href="#c-create-a-cmakelisttxt" title="Permanent link">&para;</a></h4>
<p>It should:</p>
<ul>
<li>
<p>build an executable <code>gemm</code> from <code>main.c</code> and <code>sgemm.c</code>.</p>
</li>
<li>
<p>build an executable <code>test_runner</code> from <code>test_runner.c</code> and <code>sgemm.c</code> using the <code>unity</code> testing framework as shown in previous labs.</p>
</li>
<li>
<p>allow changing the build type (Debug/Release) from the command line with different sets of flags.</p>
</li>
</ul>
<p>Check that your code compiles and that the test passes.</p>
<h3 id="2-naive-sgemm-implementation">2. Naive SGEMM implementation<a class="headerlink" href="#2-naive-sgemm-implementation" title="Permanent link">&para;</a></h3>
<h4 id="a-implement-the-naive-version-of-sgemm-in-sgemmc-using-three-nested-loops-in-the-order-i-j-k">a) Implement the naive version of <code>sgemm</code> in <code>sgemm.c</code> using three nested loops in the order (i, j, k).<a class="headerlink" href="#a-implement-the-naive-version-of-sgemm-in-sgemmc-using-three-nested-loops-in-the-order-i-j-k" title="Permanent link">&para;</a></h4>
<h4 id="b-add-various-tests-in-test_sgemmc-that-checks-that-your-sgemm-implementation-correctly-computes-the-product-of-small-matrices-with-variying-sizes-and-shapes-eg-2x2-3x1-1x3-3x3">b) Add various tests in <code>test_sgemm.c</code> that checks that your <code>sgemm</code> implementation correctly computes the product of small matrices with variying sizes and shapes (e.g. 2x2, 3x1, 1x3, 3x3).<a class="headerlink" href="#b-add-various-tests-in-test_sgemmc-that-checks-that-your-sgemm-implementation-correctly-computes-the-product-of-small-matrices-with-variying-sizes-and-shapes-eg-2x2-3x1-1x3-3x3" title="Permanent link">&para;</a></h4>
<h4 id="c-check-that-your-tests-pass">c) Check that your tests pass.<a class="headerlink" href="#c-check-that-your-tests-pass" title="Permanent link">&para;</a></h4>
<p>Now that you have a working implementation, you can call <code>sgemm</code> from <code>main.c</code> with random matrices of different sizes passed as command line arguments.</p>
<h2 id="2-performance-measurement-harness">2 - Performance measurement harness<a class="headerlink" href="#2-performance-measurement-harness" title="Permanent link">&para;</a></h2>
<p>Create a new directory <code>performance/</code> and add two files: <code>compare-sizes.sh</code> and <code>plot-sizes.py</code>.
For both the measurement harness and plotting script follow best practices taught in <a href="../lecture4/">lecture 4</a>.</p>
<h3 id="1-measure-performance-and-energy-consumption">1. Measure performance and energy consumption<a class="headerlink" href="#1-measure-performance-and-energy-consumption" title="Permanent link">&para;</a></h3>
<p>We will use <code>perf</code> to measure the elapsed time and energy consumption of our SGEMM implementation.</p>
<p>Example command to measure duration_time and energy consumption of a run of <code>sgemm</code> with M=512, K=512, N=512:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>perf<span class="w"> </span>stat<span class="w"> </span>-r<span class="w"> </span><span class="m">3</span><span class="w"> </span>-a<span class="w"> </span>-e<span class="w"> </span>duration_time,power/energy-pkg/<span class="w"> </span>./sgemm<span class="w"> </span>naive<span class="w"> </span><span class="m">512</span><span class="w"> </span><span class="m">512</span><span class="w"> </span><span class="m">512</span>
</span></code></pre></div></p>
<p>The <code>-r 3</code> option tells <code>perf</code> to repeat the measurement 3 times and report the mean and variance.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>
<p>You can use <code>LC_NUMERIC=C</code> to ensure that the decimal separator is a dot (<code>.</code>) instead of a comma (<code>,</code>) in the output of <code>perf</code>, which is useful for parsing the output.</p>
</li>
<li>
<p>The <code>-a</code> option can be used to measure system-wide events, which is needed for energy measurements.</p>
</li>
<li>
<p>For added stability you can use <code>taskset</code> to pin the process to a specific CPU core and disable frequency scaling with <code>cpufreq-set</code>.</p>
</li>
</ul>
</div>
<h3 id="2-write-a-script-compare-sizessh">2. Write a script <code>compare-sizes.sh</code><a class="headerlink" href="#2-write-a-script-compare-sizessh" title="Permanent link">&para;</a></h3>
<p>The script should:</p>
<ul>
<li>run <code>sgemm</code> with N=512, K=512 and M with increasing sizes (e.g. 100, 200, 300, ..., 3000).</li>
<li>measure the time and energy consumption using <code>perf stat</code> for each run.</li>
<li>define a variable <code>REPETITIONS</code> that controls how many times each configuration is repeated. <code>perf</code> supports the <code>-r</code> option to repeat measurements. It outputs the mean and variance of the measurements, allowing to plot error bars.</li>
<li>define a variable <code>EVENTS</code> to specify the events to measure (e.g. <code>duration_time,power/energy-pkg/</code>).</li>
<li>aggregate all measures into a <code>.json</code> file or <code>.csv</code> file.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you are using <code>json</code>, you can use <code>jq</code> to process the output of <code>perf stat</code> and aggregate the results together with <code>jq -s 'flatten(1)'</code>.</p>
</div>
<h3 id="3-write-a-script-plot-sizespy">3. Write a script <code>plot-sizes.py</code><a class="headerlink" href="#3-write-a-script-plot-sizespy" title="Permanent link">&para;</a></h3>
<p>The script should:</p>
<ul>
<li>read the output of the previous script and produces a plot with two y-axes:</li>
<li>left y-axis: time (with error bars)</li>
<li>right y-axis: energy consumption (with error bars)</li>
</ul>
<h4 id="a-run-your-scripts-and-produce-an-initial-plot">a) Run your scripts and produce an initial plot.<a class="headerlink" href="#a-run-your-scripts-and-produce-an-initial-plot" title="Permanent link">&para;</a></h4>
<h4 id="b-inspect-your-plot-do-you-see-any-knee-points-can-you-explain-them-hint-consider-cache-sizes">b) Inspect your plot. Do you see any knee points? Can you explain them? (Hint: consider cache sizes.)<a class="headerlink" href="#b-inspect-your-plot-do-you-see-any-knee-points-can-you-explain-them-hint-consider-cache-sizes" title="Permanent link">&para;</a></h4>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use the following commands to inspect your CPU and memory topology:</p>
<ul>
<li>
<p><code>lstopo</code> to view memory/core topology (if available).</p>
</li>
<li>
<p><code>cat /proc/cpuinfo</code> to inspect core model, cache sizes.</p>
</li>
<li>
<p>do not forget to include the units in your plot (e.g. ns, ms, s, mJ, J, ...).</p>
</li>
</ul>
</div>
<h2 id="3-optimizations">3 - Optimizations<a class="headerlink" href="#3-optimizations" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In this section we will implement different optimizations step by step. After each optimization, you should run your performance measurement harness to see the impact of the optimization on performance and energy consumption.</p>
<p>Each new version of the code should be implemented in a new function (e.g. <code>sgemm_ikj</code>, <code>sgemm_blocked</code>, <code>sgemm_omp</code>), and you should add a command line option to <code>main.c</code> to select which version to run.</p>
<p>Do not forget to add tests for each new version of <code>sgemm</code> in <code>test_sgemm.c</code>.</p>
</div>
<h3 id="1-vectorization">1. Vectorization<a class="headerlink" href="#1-vectorization" title="Permanent link">&para;</a></h3>
<p>Modern CPUs have SIMD units (SSE/AVX/AVX512). The compiler can generate SIMD code, but the code and data layout must be friendly.</p>
<h4 id="a-compiler-flags">a) Compiler flags<a class="headerlink" href="#a-compiler-flags" title="Permanent link">&para;</a></h4>
<ol>
<li>Compile with <code>-O3 -march=native</code> and inspect compiler vectorization reports (GCC/Clang flags to tell whether loops were vectorized: <code>-fopt-info-vec-optimized</code> or <code>-Rpass=loop-vectorize</code>).</li>
<li>Measure runtime/energy after changes. Observe and explain differences.</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If the compiler does not vectorize your loops, try to understand why. Common reasons include:</p>
<ul>
<li>
<p>Data dependencies that prevent reordering.</p>
</li>
<li>
<p>Pointer aliasing (use <code>restrict</code> keyword if applicable).</p>
</li>
<li>
<p>Complex control flow inside loops.</p>
</li>
</ul>
</div>
<h4 id="b-loop-order-stride">b) Loop order / stride<a class="headerlink" href="#b-loop-order-stride" title="Permanent link">&para;</a></h4>
<p>Ensure the innermost loop has contiguous memory accesses.</p>
<ol>
<li>Create a new function <code>sgemm_ikj</code> and call it from <code>main.c</code>. Add a command line option to select which version to run.</li>
<li>Change the loop order to (i, k, j).</li>
<li>Measure runtime/energy and compare to the naive version. Explain differences.</li>
</ol>
<h4 id="c-add-two-new-scripts-to-performance">c) Add two new scripts to <code>performance/</code><a class="headerlink" href="#c-add-two-new-scripts-to-performance" title="Permanent link">&para;</a></h4>
<ul>
<li><code>compare-optimizations.sh</code>: compares the naive and <code>ikj</code> implementations for a chosen matrix size.</li>
<li><code>plot-optimizations.py</code>: plots the performance and energy consumption of each implementation. Include error bars as before.</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can use the same structure as <code>compare-sizes.sh</code> and <code>plot-sizes.py</code>, but modify them to compare different implementations for a fixed matrix size.
Make the scripts generic enough to easily add new implementations in the future.</p>
</div>
<h3 id="2-cache-blocking">2. Cache blocking<a class="headerlink" href="#2-cache-blocking" title="Permanent link">&para;</a></h3>
<p>Access to <code>B</code> in the naive algorithm typically strides through columns — poor locality for row-major storage. Blocking (tiling) improves cache reuse.</p>
<h4 id="a-measure-last-level-cache-events-for-the-naive-implementation">a) Measure last-level-cache events for the naive implementation.<a class="headerlink" href="#a-measure-last-level-cache-events-for-the-naive-implementation" title="Permanent link">&para;</a></h4>
<p>Use <code>perf stat</code> with <code>LLC-loads</code> and <code>LLC-stores</code> events. Example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>perf<span class="w"> </span>stat<span class="w"> </span>-e<span class="w"> </span>LLC-loads,LLC-stores<span class="w"> </span>./sgemm<span class="w"> </span>sgemm_ikj<span class="w"> </span><span class="m">1280</span><span class="w"> </span><span class="m">512</span><span class="w"> </span><span class="m">512</span>
</span></code></pre></div>
<h4 id="b-implement-a-blocked-matrix-multiplication">b) Implement a blocked matrix multiplication<a class="headerlink" href="#b-implement-a-blocked-matrix-multiplication" title="Permanent link">&para;</a></h4>
<p>Define a block size <code>BLOCK_SIZE</code> and implement <code>sgemm_blocked</code> in <code>sgemm.c</code>:</p>
<div class="language-c highlight"><span class="filename">sgemm.h</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cp">#define BLOCK_SIZE 512  </span><span class="cm">/* block size, tune for your CPU cache */</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="cm">/* sgemm_blocked has the same prototype as sgemm and sgemm_ikj */</span><span class="w"> </span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">sgemm_blocked</span><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p>Do not forget to call it from <code>main.c</code> and add a command line option to select it.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<ul>
<li>
<p>Ensure <code>n</code> is a multiple of <code>BLOCK</code> for simplicity; either restrict inputs or pad matrices (padding can be an exercise).</p>
</li>
<li>
<p>Inside blocks, use simple triple loops over block elements (ensure indices map correctly to row-major layout).</p>
</li>
</ul>
</div>
<h4 id="c-measure-llc-loadsstores-for-the-blocked-version-and-compare-to-naive">c) Measure LLC loads/stores for the blocked version and compare to naive.<a class="headerlink" href="#c-measure-llc-loadsstores-for-the-blocked-version-and-compare-to-naive" title="Permanent link">&para;</a></h4>
<h4 id="d-measure-energy-and-time-for-blocked-version-and-compare">d) Measure energy and time for blocked version and compare.<a class="headerlink" href="#d-measure-energy-and-time-for-blocked-version-and-compare" title="Permanent link">&para;</a></h4>
<p>Modify your <code>compare-optimizations.sh</code> script to include the blocked version in the comparisons.</p>
<h4 id="e-why-does-blocking-reduce-llc-misses-and-energytime">e) Why does blocking reduce LLC misses and energy/time?<a class="headerlink" href="#e-why-does-blocking-reduce-llc-misses-and-energytime" title="Permanent link">&para;</a></h4>
<h2 id="3-parallelization-with-openmp">3 - Parallelization with OpenMP<a class="headerlink" href="#3-parallelization-with-openmp" title="Permanent link">&para;</a></h2>
<p>In this section, we focus on parallelizing the blocked matrix multiplication using OpenMP. While we will only target the CPU for now, other parallel runtimes (e.g., MPI, TBB) could also be explored in the future.</p>
<h3 id="1-implement-a-parallel-version-using-openmp">1. Implement a parallel version using OpenMP<a class="headerlink" href="#1-implement-a-parallel-version-using-openmp" title="Permanent link">&para;</a></h3>
<ul>
<li>Use OpenMP to parallelize the blocked version of <code>sgemm</code>.</li>
<li>
<p>Parallelize over blocks of rows for better load balancing.</p>
<p>Add <code>#include &lt;omp.h&gt;</code> at the top of your <code>sgemm.c</code> file.
Use the following pragma to parallelize the outer loop:
<div class="language-c highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="cp">#pragma omp parallel for schedule(static)</span>
</span></code></pre></div></p>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Static scheduling is often a good choice for matrix multiplication since the
workload is evenly distributed, but you can experiment with other scheduling
strategies (e.g., dynamic, guided) to see their impact on performance.</p>
</div>
<h3 id="2-compile-and-measure-performance">2. Compile and measure performance<a class="headerlink" href="#2-compile-and-measure-performance" title="Permanent link">&para;</a></h3>
<p>You can set the number of threads with the <code>OMP_NUM_THREADS</code> environment variable. For example, to use 8 threads:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">8</span><span class="w">  </span><span class="c1"># Adjust based on your machine</span>
</span></code></pre></div>
<p>Plot the performance and energy consumption of your OpenMP implementation for different numbers of threads (e.g., 1, 2, 4, 8, 16).
Add your scripts to <code>performance/</code> and produce a scalability plot.</p>
<h3 id="3-tune-openmp-settings">3. Tune OpenMP settings<a class="headerlink" href="#3-tune-openmp-settings" title="Permanent link">&para;</a></h3>
<p>You can experiment with different OpenMP settings to optimize performance and energy consumption. For example, you can set the thread affinity to bind threads to specific cores:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span><span class="m">6</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_PLACES</span><span class="o">=</span>cores
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OMP_PROC_BIND</span><span class="o">=</span>close<span class="w">        </span><span class="c1"># or &#39;spread&#39; to experiment</span>
</span></code></pre></div></p>
<h3 id="4-analyze-results">4. Analyze results<a class="headerlink" href="#4-analyze-results" title="Permanent link">&para;</a></h3>
<ul>
<li>Compare energy consumption and runtime to the single-threaded version.</li>
<li>Experiment with different numbers of threads and observe the impact on energy and time.</li>
<li>Is energy per run higher or lower with more threads? Why?</li>
<li>How does memory bandwidth affect scaling as more threads are added?</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Keep all your performance results, plots, and analysis for your final report that you will submit at the end of <a href="../lab7/">lab 7</a>. </p>
</div>
<h2 id="4-making-a-library">4 - Making a Library<a class="headerlink" href="#4-making-a-library" title="Permanent link">&para;</a></h2>
<p>Now that you have optimized your SGEMM implementation, you can package it as a library.
In the next lab, we will use your library to implement a simple Neural Network inference engine. </p>
<p>To do so, modify your <code>CMakeLists.txt</code> to build a static library <code>libsgemm.a</code> from <code>sgemm.c</code> and <code>sgemm.h</code>. Ensure the prototypes in the public header <code>sgemm.h</code> are well commented in Doxygen style. Modify the <code>CMakeLists.txt</code> so that users of the library
know where to find the header files.</p>
<h2 id="5-for-further-study">5 - For further study<a class="headerlink" href="#5-for-further-study" title="Permanent link">&para;</a></h2>
<p>The matrix product we have implemented is efficient, but it is possible to push optimizations even further. Here are some references and avenues if this work interests you:</p>
<ul>
<li>
<p><strong>Algorithmic improvements</strong> such as Strassen allow to trade multiplications for additions, which in some cases can be beneficial.</p>
</li>
<li>
<p><strong>Cache-oblivious algorithms</strong> (recursive tiling based on space-filling curves).
Instead of using blocking techniques, which must be parameterized by a fixed
block size; it is possible to implement matrix multiplication to preserve
locality regardless of scale. This is called a cache-oblivious algorithm in
English. For matrix multiplication, such an algorithm can be obtained by
reordering the elements according to the order given by the Lebesgue curve.
This allows obtaining very efficient implementations for matrices whose
dimension is a power of two.  </p>
</li>
<li>
<p><strong>Advanced BLAS</strong>. You can compare your implementation with <code>cblas_sgemm</code> from
optimized vendor libraries (OpenBLAS, Intel MKL). You can even try using
<code>cublas</code> library to target GPUs.</p>
</li>
</ul>
<hr class="gradient" />

<div class="summary-section box-section">
<h2 class="hidden-title" id="7-summary"> 7 - Summary<a class="headerlink" href="#7-summary" title="Permanent link">&para;</a></h2>
<p>Upon completing this lab, you should know how to:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Write a naive implementation of the SGEMM algorithm.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Measure performance and energy consumption using <code>perf</code>.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Optimize the SGEMM algorithm using vectorization, loop reordering, cache blocking, and parallelization with OpenMP.</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled checked/><span class="task-list-indicator"></span></label> Analyze the impact of optimizations on performance and energy consumption.</li>
</ul>
</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lab5/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 5 - Experimental Methodology and Scientific Reporting">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Lab 5 - Experimental Methodology and Scientific Reporting
              </div>
            </div>
          </a>
        
        
          
          <a href="../lab7/" class="md-footer__link md-footer__link--next" aria-label="Next: Lab 7 - AI Project (2) Neural Network Inference">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Lab 7 - AI Project (2) Neural Network Inference
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      CC BY-NC 4.0; 2025 - Pablo de Oliveira Castro, Mathys E. Jam
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.path", "navigation.instant", "navigation.instant.progress", "navigation.expand", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.footer", "header.autohide", "toc.integrate", "content.code.annotate", "content.tabs.link", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>